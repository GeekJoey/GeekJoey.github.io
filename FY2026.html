<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>2026 Free Yourself</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            position: relative;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 20px;
        }

        .header h1 {
            font-size: 2em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .status-bar {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 15px;
        }

        .status-message {
            flex: 1;
        }

        .status-message.loading {
            color: #667eea;
            font-weight: 600;
        }

        .status-message.success {
            color: #155724;
            background: #d4edda;
            padding: 10px 15px;
            border-radius: 8px;
        }

        .status-message.error {
            color: #721c24;
            background: #f8d7da;
            padding: 10px 15px;
            border-radius: 8px;
        }

        .config-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
            display: none;
        }

        .config-section.show {
            display: block;
            animation: slideDown 0.3s ease-out;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .config-section h3 {
            color: #667eea;
            margin-bottom: 15px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #555;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #555;
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        .btn-save-config {
            background: linear-gradient(135deg, #1a365d 0%, #2c5282 100%);
            color: white;
        }

        .btn-save-config:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(26, 54, 93, 0.4);
        }

        .btn-settings {
            background: linear-gradient(135deg, #1a365d 0%, #2c5282 100%);
            color: white;
            border: none;
            border-radius: 50%;
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3em;
            padding: 0;
            position: absolute;
            top: 20px;
            right: 20px;
            z-index: 10;
            box-shadow: 0 4px 12px rgba(26, 54, 93, 0.4);
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-settings:hover {
            transform: rotate(90deg);
            box-shadow: 0 6px 16px rgba(26, 54, 93, 0.6);
        }

        @media (max-width: 768px) {
            .btn-settings {
                width: 40px;
                height: 40px;
                font-size: 1.1em;
                top: 15px;
                right: 15px;
            }
        }

        /* è¢«å¯å‘æ¨¡å—æ ·å¼ */
        .inspire-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 8px 24px rgba(102, 126, 234, 0.3);
            position: relative;
            overflow: hidden;
        }

        .inspire-section::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 100%;
            height: 200%;
            background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, transparent 100%);
            transform: rotate(30deg);
            pointer-events: none;
        }

        .inspire-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .inspire-section h3 {
            color: white;
            margin: 0;
            font-size: 1.3em;
            font-weight: 600;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
            position: relative;
        }

        .btn-add-inspire {
            background: rgba(255, 255, 255, 0.25);
            color: white;
            width: 38px;
            height: 38px;
            font-size: 24px;
            line-height: 38px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
            backdrop-filter: blur(10px);
        }

        .btn-add-inspire:hover {
            background: rgba(255, 255, 255, 0.35);
            transform: scale(1.1);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.25);
        }

        .daily-inspiration {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 20px;
            text-align: left;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            position: relative;
        }

        .daily-inspiration-label {
            color: #667eea;
            font-size: 0.85em;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 12px;
        }

        .daily-inspiration-content {
            color: #333;
            font-size: 1.1em;
            line-height: 1.6;
            font-style: italic;
        }

        .inspire-content-text {
            margin-bottom: 10px;
            color: #444;
            line-height: 1.7;
        }

        .btn-edit-inspire {
            background: rgba(102, 126, 234, 0.15);
            color: #667eea;
            padding: 6px 16px;
            font-size: 0.85em;
            border: 1px solid rgba(102, 126, 234, 0.3);
            border-radius: 15px;
            cursor: pointer;
            transition: all 0.3s;
            position: absolute;
            top: 12px;
            right: 12px;
        }

        .btn-edit-inspire:hover {
            background: rgba(102, 126, 234, 0.25);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
        }

        .inspire-actions {
            display: flex;
            justify-content: center;
            gap: 12px;
            flex-wrap: wrap;
        }

        .btn-inspire {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            padding: 12px 28px;
            font-size: 0.95em;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
        }

        .btn-inspire:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
        }

        .btn-refresh-inspire {
            background: rgba(255, 255, 255, 0.2);
            color: white;
            padding: 12px 28px;
            font-size: 0.95em;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s;
            backdrop-filter: blur(10px);
        }

        .btn-refresh-inspire:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
        }

        .milestone-section {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 8px 24px rgba(102, 126, 234, 0.3);
            position: relative;
            overflow: hidden;
        }

        .milestone-section::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 100%;
            height: 200%;
            background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, transparent 100%);
            transform: rotate(30deg);
            pointer-events: none;
        }

        .milestone-section h3 {
            color: white;
            margin: 0;
            font-size: 1.3em;
            font-weight: 600;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
            position: relative;
        }

        .milestone-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .btn-add-milestone {
            background: rgba(255, 255, 255, 0.25);
            color: white;
            width: 38px;
            height: 38px;
            font-size: 24px;
            line-height: 38px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
            backdrop-filter: blur(10px);
        }

        .btn-add-milestone:hover {
            background: rgba(255, 255, 255, 0.35);
            transform: scale(1.1);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.25);
        }

        .milestone-list {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            min-height: 40px;
        }

        .empty-milestone {
            color: rgba(255, 255, 255, 0.7);
            font-style: italic;
            font-size: 0.95em;
            width: 100%;
            text-align: center;
            padding: 20px 0;
        }

        .milestone-tag {
            background: rgba(255, 255, 255, 0.95);
            color: #333;
            padding: 10px 18px;
            border-radius: 25px;
            font-size: 0.9em;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            border: 2px solid rgba(255, 255, 255, 0.5);
        }

        .milestone-tag:hover {
            background: white;
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(0, 0, 0, 0.25);
        }

        .milestone-tag .milestone-date {
            color: #667eea;
            font-weight: 600;
            font-size: 0.85em;
        }

        .milestone-tag .delete-milestone {
            color: #ff6b6b;
            cursor: pointer;
            font-weight: bold;
            opacity: 0.5;
            transition: opacity 0.3s;
            margin-left: 4px;
        }

        .milestone-tag .delete-milestone:hover {
            opacity: 1;
        }

        /* ç»Ÿè®¡ä¿¡æ¯åŒºåŸŸæ ·å¼ï¼ˆå·²åœç”¨ï¼‰ */
        .stats-section {
            display: none;
        }

        .countdown-box {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
        }

        .countdown-title {
            font-size: 1.1em;
            color: #555;
            margin-bottom: 10px;
        }

        .countdown-days {
            font-size: 3em;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 5px;
        }

        .countdown-label {
            font-size: 0.9em;
            color: #777;
        }

        .countdown-extra {
            margin-top: 10px;
            font-size: 0.95em;
            color: #555;
        }

        .current-date {
            color: #777;
            font-size: 0.9em;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(1, 1fr);
            gap: 20px;
        }

        .month-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
        }

        .month-title {
            text-align: center;
            font-size: 1.5em;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 15px;
        }

        .days-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 8px;
        }

        .day {
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            font-size: 0.9em;
            padding: 8px 4px;
        }

        .day:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        .day.other-month {
            color: #ccc;
            background: #f5f5f5;
        }

        .day.weekend {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            border: 1px solid #fcb69f;
        }

        .day.holiday {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            border: 1px solid #fcb69f;
        }

        .day.workday-adjust {
            background: white;
            border: 1px solid #ddd;
        }

        .day.today {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            font-weight: 700;
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .day.checked-in {
            background: linear-gradient(135deg, #a8ff78 0%, #78ffd6 100%);
            font-weight: 600;
        }

        .day-number {
            font-size: 1.1em;
            margin-bottom: 4px;
        }

        .mood-score {
            font-size: 0.75em;
            color: #667eea;
            font-weight: 700;
        }

        .day.checked-in .mood-score {
            color: #333;
        }

        .mood-indicator {
            position: absolute;
            bottom: 4px;
            right: 4px;
            font-size: 0.9em;
        }

        /* èŠ‚å‡æ—¥å’Œè°ƒä¼‘æ ‡æ³¨ */
        .day-tag {
            position: absolute;
            top: 2px;
            right: 2px;
            font-size: 0.55em;
            font-weight: 700;
            padding: 1px 3px;
            border-radius: 3px;
            line-height: 1;
            z-index: 10;
            background: transparent !important;
            text-shadow: 0 0 2px white;
        }

        .day.holiday .day-tag {
            color: #ff4444 !important;
            font-size: 0.5em;
            font-weight: 700;
            text-shadow: 0 0 3px white, 0 0 3px white, 0 0 3px white;
        }

        .day.workday-adjust .day-tag {
            color: #d4a800 !important;
            font-size: 0.5em;
            font-weight: 700;
            text-shadow: 0 0 3px white, 0 0 3px white, 0 0 3px white;
        }

        /* å›¾ä¾‹è¯´æ˜ */
        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin: 15px 0;
            padding: 15px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            font-size: 0.9em;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        /* æ—¥å†åˆ‡æ¢æ§ä»¶ */
        .calendar-controls {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .calendar-title {
            font-size: 1.3em;
            font-weight: 700;
            color: #667eea;
            text-align: center;
            flex: 1;
        }

        .calendar-nav-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            width: 44px;
            height: 44px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3em;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .calendar-nav-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 16px rgba(102, 126, 234, 0.4);
        }

        .calendar-nav-btn:disabled {
            opacity: 0.4;
            cursor: not-allowed;
            transform: none;
        }

        /* æ—¥å†å®¹å™¨ */
        .calendar-container {
            position: relative;
            overflow: hidden;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);
            touch-action: pan-y;
        }

        .calendar-slide {
            transition: transform 0.3s ease-out;
            will-change: transform;
        }

        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .legend-color {
            width: 18px;
            height: 18px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7em;
            color: #333;
            font-weight: 600;
        }

        .legend-color.today {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .legend-color.checked-in {
            background: linear-gradient(135deg, #a8ff78 0%, #78ffd6 100%);
        }

        .legend-color.holiday {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            border: 1px solid #fcb69f;
            color: #ff4444;
            font-weight: 700;
        }

        .legend-color.workday-adjust {
            background: white;
            border: 1px solid #ddd;
            color: #ffcc00;
            font-weight: 700;
        }

        .legend-color.weekend {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            border: 1px solid #fcb69f;
        }

        .legend-color.normal {
            background: white;
            border: 1px solid #ddd;
        }

        /* æ¨¡æ€æ¡† */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            align-items: center;
            justify-content: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            padding: 30px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .modal-header h2 {
            color: #667eea;
            margin: 0;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: #999;
        }

        .close-btn:hover {
            color: #333;
        }

        .mood-display {
            font-size: 1.5em;
            font-weight: 700;
        }

        .mood-slider-container {
            margin: 20px 0;
        }

        .mood-slider {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            background: linear-gradient(90deg, #ff6b6b 0%, #ffd93d 50%, #4ecdc4 100%);
            outline: none;
            -webkit-appearance: none;
        }

        .mood-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: white;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            border: 3px solid #667eea;
        }

        .mood-slider::-moz-range-thumb {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: white;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
            border: 3px solid #667eea;
        }

        .mood-value {
            text-align: center;
            font-size: 1.5em;
            font-weight: 700;
            color: #667eea;
            margin-top: 10px;
        }

        .mood-emoji {
            font-size: 2em;
            text-align: center;
            margin-top: 10px;
        }

        textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
            resize: vertical;
            min-height: 80px;
        }

        textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .modal-actions {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        .checkin-detail {
            margin-top: 20px;
            padding: 15px;
            background: #f5f5f5;
            border-radius: 8px;
        }

        .milestone-detail-content {
            margin-top: 20px;
            padding: 15px;
            background: #f5f5f5;
            border-radius: 8px;
        }

        .detail-row {
            margin-bottom: 15px;
        }

        .detail-row strong {
            display: inline-block;
            min-width: 80px;
            color: #555;
        }

        .checkin-detail p {
            margin: 8px 0;
            word-wrap: break-word;
        }

        /* ç¼–è¾‘å¤‡æ³¨åŒºåŸŸ */
        .edit-note-section {
            margin-top: 20px;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 8px;
        }

        /* å“åº”å¼ä¼˜åŒ– */
        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }

            .days-grid {
                gap: 4px;
            }

            .day {
                font-size: 0.75em;
                padding: 4px 2px;
            }

            .day-number {
                font-size: 0.95em;
                margin-bottom: 2px;
            }

            .mood-score {
                font-size: 0.6em;
                font-weight: 700;
            }

            .day-tag {
                font-size: 0.5em;
                padding: 1px 2px;
            }

            .status-bar {
                flex-direction: column;
                align-items: flex-start;
            }

            .btn-settings {
                width: 40px;
                height: 40px;
                font-size: 1.1em;
                top: 15px;
                right: 15px;
            }

            .modal-content {
                padding: 20px;
                max-width: 95%;
            }

            .countdown-days {
                font-size: 2.5em;
            }

            .month-title {
                font-size: 1.3em;
            }

            .legend {
                font-size: 0.8em;
                gap: 10px;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 10px;
            }

            .day {
                font-size: 0.65em;
                padding: 3px 1px;
            }

            .day-number {
                font-size: 0.85em;
            }

            .mood-score {
                font-size: 0.55em;
            }

            .day-tag {
                font-size: 0.45em;
                padding: 0.5px 1.5px;
            }

            .modal-content {
                padding: 15px;
            }

            .modal-header h2 {
                font-size: 1.3em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <button class="btn btn-settings" id="settingsBtn" title="Supabaseè®¾ç½®">âš™ï¸</button>
        <div class="header">
            <h1>2026 Free Yourself</h1>
            <p style="color: rgba(255,255,255,0.8);">designed by Joeyyaoyz</p>
        </div>

        <!-- çŠ¶æ€æ  -->
        <div class="status-bar" id="statusBar">
            <div class="status-message" id="statusMessage">
                <span class="loading">â³ æ­£åœ¨è¿æ¥ Supabase...</span>
            </div>
        </div>

        <!-- Supabase é…ç½®é¢æ¿ï¼ˆé»˜è®¤éšè—ï¼‰ -->
        <div class="config-section" id="configSection">
            <h3>ğŸ”— Supabase äº‘åŒæ­¥é…ç½®</h3>
            <div class="form-group">
                <label for="supabaseUrl">Supabase URL</label>
                <input type="text" id="supabaseUrl" placeholder="https://xxxxx.supabase.co">
            </div>
            <div class="form-group">
                <label for="supabaseKey">Supabase Anon Key</label>
                <input type="password" id="supabaseKey" placeholder="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...">
            </div>
            <div>
                <button class="btn btn-save-config" id="saveConfigBtn">ä¿å­˜å¹¶é‡æ–°è¿æ¥</button>
                <button class="btn btn-secondary" id="cancelConfigBtn">å–æ¶ˆ</button>
            </div>
        </div>

        <!-- è¢«å¯å‘æ¨¡å— -->
        <div class="inspire-section" id="inspireSection">
            <div class="inspire-header">
                <h3>âœ¨ çµæ„Ÿè®°å½•</h3>
                <button class="btn-add-inspire" id="inspireBtn" title="è®°å½•çµæ„Ÿ">+</button>
            </div>
            <div class="daily-inspiration" id="dailyInspiration">
                <div class="daily-inspiration-label">ä»Šæ—¥çµæ„Ÿ</div>
                <div class="daily-inspiration-content" id="dailyInspirationContent">æ­£åœ¨åŠ è½½ä»Šæ—¥çµæ„Ÿ...</div>
            </div>
            <div class="inspire-actions">
                <button class="btn-refresh-inspire" id="refreshInspireBtn">ğŸ”„ æ¢ä¸€æ¡</button>
            </div>
        </div>

        <!-- é‡Œç¨‹ç¢‘ -->
        <div class="milestone-section" id="milestoneSection">
            <div class="milestone-header">
                <h3>ğŸ¯ é‡Œç¨‹ç¢‘</h3>
                <button class="btn-add-milestone" id="addMilestoneBtn" title="æ–°å¢é‡Œç¨‹ç¢‘">+</button>
            </div>
            <div class="milestone-list" id="milestoneList">
                <div class="empty-milestone">æš‚æ— é‡Œç¨‹ç¢‘è®°å½•</div>
            </div>
        </div>

        <!-- å€’è®¡æ—¶ -->
        <div class="countdown-box">
            <div class="countdown-title">è·ç¦» 6æœˆ12æ—¥ è¿˜æœ‰</div>
            <div class="countdown-days" id="countdown">-</div>
            <div class="countdown-label">ä¸ªå·¥ä½œæ—¥ï¼ˆéå‘¨æœ«+èŠ‚å‡æ—¥ï¼‰</div>
            <div class="countdown-extra" id="countdownExtra">å‰©ä½™å‘¨æ•°ï¼š-</div>
            <div style="margin-top: 10px;">
                <span class="current-date">ä»Šå¤©ï¼š<span id="currentDate"></span></span>
            </div>
        </div>

        <!-- å›¾ä¾‹è¯´æ˜ -->
        <div class="legend">
            <div class="legend-item">
                <div class="legend-color today">ä»Š</div>
                <span>ä»Šå¤©</span>
            </div>
            <div class="legend-item">
                <div class="legend-color checked-in">âœ“</div>
                <span>å·²æ‰“å¡</span>
            </div>
            <div class="legend-item">
                <div class="legend-color holiday">èŠ‚</div>
                <span>èŠ‚å‡æ—¥</span>
            </div>
            <div class="legend-item">
                <div class="legend-color workday-adjust">ç­</div>
                <span>è°ƒä¼‘å·¥ä½œæ—¥</span>
            </div>
            <div class="legend-item">
                <div class="legend-color weekend"></div>
                <span>å‘¨æœ«</span>
            </div>
            <div class="legend-item">
                <div class="legend-color normal"></div>
                <span>æ™®é€šå·¥ä½œæ—¥</span>
            </div>
        </div>

        <!-- æ—¥å†åˆ‡æ¢æ§ä»¶ -->
        <div class="calendar-controls">
            <button class="calendar-nav-btn" id="prevMonthBtn" title="ä¸Šä¸ªæœˆ">â®</button>
            <div class="calendar-title" id="calendarTitle">2026å¹´2æœˆ</div>
            <button class="calendar-nav-btn" id="nextMonthBtn" title="ä¸‹ä¸ªæœˆ">â¯</button>
        </div>

        <!-- æ—¥å† -->
        <div class="calendar-container" id="calendarContainer">
            <div class="calendar-slide" id="calendarSlide">
                <div class="month-card" id="currentMonthCard">
                    <div class="month-title" id="monthTitle">äºŒæœˆ</div>
                    <div class="days-grid" id="daysGrid"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- é‡Œç¨‹ç¢‘æ¨¡æ€æ¡† -->
    <div class="modal" id="milestoneModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="milestoneModalTitle">æ–°å¢é‡Œç¨‹ç¢‘</h2>
                <button class="close-btn" id="closeMilestoneModalBtn">&times;</button>
            </div>
            <div class="form-group">
                <label for="milestoneTitle" style="display: block; margin-bottom: 10px; font-weight: 600;">é‡Œç¨‹ç¢‘äº‹ä»¶</label>
                <input type="text" id="milestoneTitle" placeholder="ä¾‹å¦‚ï¼šé¡¹ç›®ä¸Šçº¿ã€ç”Ÿæ—¥ã€çºªå¿µæ—¥ç­‰" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px;">
            </div>
            <div class="form-group">
                <label for="milestoneDate" style="display: block; margin-bottom: 10px; font-weight: 600;">æ—¥æœŸ</label>
                <input type="date" id="milestoneDate" style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; font-size: 14px;">
            </div>
            <div class="form-group">
                <label for="milestoneDesc" style="display: block; margin-bottom: 10px; font-weight: 600;">æè¿°</label>
                <textarea id="milestoneDesc" placeholder="æè¿°è¿™ä¸ªé‡Œç¨‹ç¢‘çš„æ„ä¹‰ã€èƒŒæ™¯æˆ–å¤‡æ³¨ä¿¡æ¯..." style="min-height: 100px;"></textarea>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" id="cancelMilestoneBtn">å–æ¶ˆ</button>
                <button class="btn btn-primary" id="saveMilestoneBtn">ä¿å­˜é‡Œç¨‹ç¢‘</button>
            </div>
        </div>
    </div>

    <!-- é‡Œç¨‹ç¢‘è¯¦æƒ…æ¨¡æ€æ¡† -->
    <div class="modal" id="milestoneDetailModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="milestoneDetailTitle">é‡Œç¨‹ç¢‘è¯¦æƒ…</h2>
                <button class="close-btn" id="closeMilestoneDetailBtn">&times;</button>
            </div>
            <div class="milestone-detail-content">
                <div class="detail-row">
                    <strong>æ—¥æœŸï¼š</strong>
                    <span id="milestoneDetailDate"></span>
                </div>
                <div class="detail-row">
                    <strong>æè¿°ï¼š</strong>
                    <div id="milestoneDetailDesc" style="margin-top: 10px; line-height: 1.6;"></div>
                </div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-primary" id="editMilestoneBtn">ç¼–è¾‘</button>
                <button class="btn btn-secondary" id="deleteMilestoneBtn">åˆ é™¤</button>
                <button class="btn btn-secondary" id="closeMilestoneDetailBtn2">å…³é—­</button>
            </div>
        </div>
    </div>

    <!-- çµæ„Ÿè®°å½•æ¨¡æ€æ¡†ï¼ˆç¼–è¾‘æ¨¡å¼ï¼‰ -->
    <div class="modal" id="inspireModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="inspireModalTitle">è®°å½•çµæ„Ÿ</h2>
                <button class="close-btn" id="closeInspireModalBtn">&times;</button>
            </div>
            <div class="form-group">
                <label for="inspireContent" style="display: block; margin-bottom: 10px; font-weight: 600;">å¯å‘å†…å®¹</label>
                <textarea id="inspireContent" placeholder="ä»Šå¤©ä½ è¢«ä»€ä¹ˆå¯å‘äº†ï¼Ÿè®°å½•ä¸‹ä½ çš„çµæ„Ÿå’Œæƒ³æ³•..." style="min-height: 120px;"></textarea>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" id="cancelInspireBtn">å–æ¶ˆ</button>
                <button class="btn btn-primary" id="saveInspireBtn">ä¿å­˜çµæ„Ÿ</button>
            </div>
        </div>
    </div>

    <!-- æ‰“å¡æ¨¡æ€æ¡† -->
    <div class="modal" id="checkinModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">æ‰“å¡</h2>
                <button class="close-btn" id="closeModalBtn">&times;</button>
            </div>

            <!-- æ‰“å¡è¡¨å• -->
            <div class="checkin-form" id="checkinForm">
                <div class="mood-slider-container">
                    <label style="display: block; margin-bottom: 10px; font-weight: 600;">å¿ƒæƒ…å€¼ (1-100)</label>
                    <input type="range" class="mood-slider" id="moodSlider" min="1" max="100" value="50">
                    <div class="mood-value" id="moodValue">50</div>
                    <div class="mood-emoji" id="moodEmoji">ğŸ˜</div>
                </div>

                <div class="form-group">
                    <label for="note">è®°å½•å†…å®¹</label>
                    <textarea id="note" placeholder="ä»Šå¤©å‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿè®°å½•ä¸‹ä½ çš„æƒ³æ³•..."></textarea>
                </div>

                <div class="modal-actions">
                    <button class="btn btn-secondary" id="cancelBtn">å–æ¶ˆ</button>
                    <button class="btn btn-primary" id="saveCheckinBtn">ä¿å­˜æ‰“å¡</button>
                </div>
            </div>

            <!-- æŸ¥çœ‹è¯¦æƒ… -->
            <div class="checkin-detail" id="checkinDetail" style="display: none;">
                <p><strong>å¿ƒæƒ…å€¼ï¼š</strong><span class="mood-display" id="detailMood"></span></p>
                <p><strong>è®°å½•ï¼š</strong><span id="detailText"></span></p>
                <p><strong>æ—¶é—´ï¼š</strong><span id="detailTime"></span></p>
                <div class="modal-actions">
                    <button class="btn btn-secondary" id="editNoteBtn">ç¼–è¾‘å¤‡æ³¨</button>
                    <button class="btn btn-secondary" id="closeDetailBtn">å…³é—­</button>
                    <button class="btn btn-primary" id="deleteCheckinBtn">åˆ é™¤æ‰“å¡</button>
                </div>
            </div>

            <!-- ç¼–è¾‘å¤‡æ³¨ -->
            <div class="edit-note-section" id="editNoteSection" style="display: none;">
                <div class="form-group">
                    <label for="editNoteInput">ç¼–è¾‘å¤‡æ³¨</label>
                    <textarea id="editNoteInput" placeholder="ä¿®æ”¹è®°å½•å†…å®¹..."></textarea>
                </div>
                <div class="modal-actions">
                    <button class="btn btn-secondary" id="cancelEditBtn">å–æ¶ˆ</button>
                    <button class="btn btn-primary" id="saveEditBtn">ä¿å­˜ä¿®æ”¹</button>
                </div>
            </div>
        </div>
    </div>

    <script>
    // ä½¿ç”¨ IIFE ç«‹å³æ‰§è¡Œå‡½æ•°ï¼Œå°†æ‰€æœ‰ä»£ç å°è£…åœ¨ç‹¬ç«‹ä½œç”¨åŸŸä¸­
    (function() {
        // ============================================================
        // ğŸ”’ é…ç½®åŒºåŸŸï¼šåœ¨è¿™é‡Œä¿®æ”¹ä½ çš„ Supabase è¿æ¥ä¿¡æ¯
        // ============================================================
        const DEFAULT_SUPABASE_CONFIG = {
            url: 'https://bbmdviffgxarxuptfftp.supabase.co',  // ğŸ‘ˆ åœ¨è¿™é‡Œå¡«å…¥ä½ çš„ Supabase URL
            key: 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJibWR2aWZmZ3hhcnh1cHRmZnRwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk5MzgyNzEsImV4cCI6MjA4NTUxNDI3MX0.qqceYnTa7ZtD-Sl1JbNFs1l_0JStdTzrrIXiXv62k54'  // ğŸ‘ˆ åœ¨è¿™é‡Œå¡«å…¥ä½ çš„ Supabase Anon Key
        };
        // ============================================================

        // 2026å¹´æ³•å®šèŠ‚å‡æ—¥é…ç½®ï¼ˆæ ¹æ®å›½åŠ¡é™¢æœ€æ–°é€šçŸ¥ï¼‰
        const holidays2026 = {
            'æ˜¥èŠ‚': {
                name: 'æ˜¥èŠ‚',
                start: { month: 1, day: 15 },  // 2æœˆ15æ—¥
                end: { month: 1, day: 23 },    // 2æœˆ23æ—¥
                workDaysBefore: [{ month: 1, day: 14 }],  // 2æœˆ14æ—¥ï¼ˆå‘¨å…­ï¼‰ä¸Šç­
                workDaysAfter: [{ month: 1, day: 28 }]   // 2æœˆ28æ—¥ï¼ˆå‘¨å…­ï¼‰ä¸Šç­
            },
            'æ¸…æ˜èŠ‚': {
                name: 'æ¸…æ˜',
                start: { month: 3, day: 4 },  // 4æœˆ4æ—¥
                end: { month: 3, day: 6 },    // 4æœˆ6æ—¥
                workDaysBefore: [],
                workDaysAfter: []
            },
            'åŠ³åŠ¨èŠ‚': {
                name: 'äº”ä¸€',
                start: { month: 4, day: 1 },  // 5æœˆ1æ—¥
                end: { month: 4, day: 5 },    // 5æœˆ5æ—¥
                workDaysBefore: [],
                workDaysAfter: [{ month: 4, day: 9 }]   // 5æœˆ9æ—¥ï¼ˆå‘¨å…­ï¼‰ä¸Šç­
            },
            'ç«¯åˆèŠ‚': {
                name: 'ç«¯åˆ',
                start: { month: 5, day: 19 },  // 6æœˆ19æ—¥
                end: { month: 5, day: 21 },    // 6æœˆ21æ—¥
                workDaysBefore: [],
                workDaysAfter: []
            }
        };

        // åº”ç”¨çŠ¶æ€
        const appState = {
            supabase: null,
            checkins: [],
            inspires: [],
            milestones: [],
            selectedDate: null,
            isConnected: false,
            currentEditingInspire: null,
            currentEditingMilestone: null,
            currentYear: 2026,
            currentMonth: 1, // é»˜è®¤æ˜¾ç¤º2æœˆï¼ˆç´¢å¼•1ï¼‰
            touchStartX: 0,
            touchEndX: 0
        };

        // è·å–æœ‰æ•ˆçš„ Supabase é…ç½®ï¼ˆä¼˜å…ˆä½¿ç”¨ localStorageï¼Œå¦åˆ™ä½¿ç”¨é»˜è®¤å€¼ï¼‰
        function getSupabaseConfig() {
            const localStorageUrl = localStorage.getItem('calendar_2026_v2_supabaseUrl');
            const localStorageKey = localStorage.getItem('calendar_2026_v2_supabaseKey');

            if (localStorageUrl && localStorageKey) {
                return {
                    url: localStorageUrl,
                    key: localStorageKey
                };
            }

            return DEFAULT_SUPABASE_CONFIG;
        }

        // æ˜¾ç¤ºçŠ¶æ€æ¶ˆæ¯
        function showStatus(message, type) {
            const statusElement = document.getElementById('statusMessage');
            statusElement.className = 'status-message ' + type;

            if (type === 'loading') {
                statusElement.innerHTML = `<span class="loading">â³ ${message}</span>`;
            } else if (type === 'success') {
                statusElement.innerHTML = `<span class="success">âœ… ${message}</span>`;
            } else if (type === 'error') {
                statusElement.innerHTML = `<span class="error">âŒ ${message}</span>`;
            }
        }

        // è¿æ¥Supabase
        async function connectSupabase(url, key) {
            showStatus('æ­£åœ¨è¿æ¥ Supabase...', 'loading');

            try {
                // æ£€æŸ¥ Supabase åº“æ˜¯å¦åŠ è½½
                if (typeof window.supabase === 'undefined' || typeof window.supabase.createClient !== 'function') {
                    throw new Error('Supabase åº“æœªåŠ è½½ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–åˆ·æ–°é¡µé¢');
                }

                appState.supabase = window.supabase.createClient(url, key);
                await checkTableExists();

                // ä¿å­˜é…ç½®åˆ° localStorage
                localStorage.setItem('calendar_2026_v2_supabaseUrl', url);
                localStorage.setItem('calendar_2026_v2_supabaseKey', key);

                appState.isConnected = true;

                // è¿æ¥æˆåŠŸåï¼Œè‡ªåŠ¨éšè—é…ç½®é¢æ¿
                const configSection = document.getElementById('configSection');
                configSection.classList.remove('show');

                showStatus('âœ… å·²è¿æ¥åˆ° Supabaseï¼æ•°æ®åŒæ­¥å·²å¯ç”¨ã€‚', 'success');

                // åŠ è½½æ‰“å¡æ•°æ®
                await loadCheckins();

                // åŠ è½½çµæ„Ÿæ•°æ®å¹¶æ˜¾ç¤ºä»Šæ—¥çµæ„Ÿ
                await loadInspires();
                displayDailyInspiration();

                // åŠ è½½é‡Œç¨‹ç¢‘æ•°æ®
                await loadMilestones();

            } catch (error) {
                appState.isConnected = false;
                showStatus('è¿æ¥å¤±è´¥ï¼š' + error.message, 'error');
                console.error('Supabaseè¿æ¥é”™è¯¯:', error);

                // è¿æ¥å¤±è´¥æ—¶ï¼Œæ˜¾ç¤ºé…ç½®é¢æ¿
                const configSection = document.getElementById('configSection');
                configSection.classList.add('show');

                // é¢„å¡«å……è¾“å…¥æ¡†
                document.getElementById('supabaseUrl').value = url;
                document.getElementById('supabaseKey').value = key;
            }
        }

        // æ£€æŸ¥è¡¨æ˜¯å¦å­˜åœ¨ï¼Œä¸å­˜åœ¨åˆ™åˆ›å»º
        async function checkTableExists() {
            const { error } = await appState.supabase
                .from('checkins')
                .select('*')
                .limit(1);

            if (error && error.code === '42P01') {
                throw new Error('è¡¨ "checkins" ä¸å­˜åœ¨ï¼Œè¯·å…ˆåœ¨Supabaseä¸­åˆ›å»ºè¡¨ã€‚');
            }
        }

        // åŠ è½½æ‰“å¡æ•°æ®
        async function loadCheckins() {
            if (!appState.supabase) return;

            try {
                const { data, error } = await appState.supabase
                    .from('checkins')
                    .select('*')
                    .order('date', { ascending: true });

                if (error) throw error;

                appState.checkins = data || [];
                renderCalendar();
            } catch (error) {
                console.error('åŠ è½½æ•°æ®å¤±è´¥:', error);
            }
        }

        // åŠ è½½çµæ„Ÿæ•°æ®
        async function loadInspires() {
            if (!appState.supabase) return;

            try {
                const { data, error } = await appState.supabase
                    .from('inspires')
                    .select('*')
                    .order('created_at', { ascending: false });

                if (error) {
                    // è¡¨ä¸å­˜åœ¨æ—¶é™é»˜å¤„ç†
                    console.log('çµæ„Ÿè¡¨ä¸å­˜åœ¨æˆ–åŠ è½½å¤±è´¥');
                    return;
                }

                appState.inspires = data || [];
            } catch (error) {
                console.error('åŠ è½½çµæ„Ÿæ•°æ®å¤±è´¥:', error);
            }
        }

        // æ˜¾ç¤ºä»Šæ—¥çµæ„Ÿ
        function displayDailyInspiration() {
            const contentElement = document.getElementById('dailyInspirationContent');

            if (!appState.inspires || appState.inspires.length === 0) {
                contentElement.innerHTML = 'æš‚æ— çµæ„Ÿè®°å½•ï¼Œå¿«æ¥è®°å½•ç¬¬ä¸€æ¡çµæ„Ÿå§ï¼';
                return;
            }

            // ä½¿ç”¨æ—¥æœŸä½œä¸ºéšæœºç§å­ï¼Œç¡®ä¿åŒä¸€å¤©æ˜¾ç¤ºç›¸åŒçš„çµæ„Ÿ
            const today = new Date();
            const dateStr = today.toISOString().split('T')[0];

            // è®¡ç®—ä»Šæ—¥çš„éšæœºç´¢å¼•
            let seed = 0;
            for (let i = 0; i < dateStr.length; i++) {
                seed += dateStr.charCodeAt(i);
            }

            const randomIndex = seed % appState.inspires.length;
            const todayInspiration = appState.inspires[randomIndex];

            // æ˜¾ç¤ºçµæ„Ÿå†…å®¹å’Œç¼–è¾‘æŒ‰é’®
            contentElement.innerHTML = `
                <div class="inspire-content-text">${todayInspiration.content}</div>
                <button class="btn-edit-inspire" data-id="${todayInspiration.id}" title="ç¼–è¾‘æ­¤çµæ„Ÿ">âœï¸ ç¼–è¾‘</button>
            `;

            // ç»‘å®šç¼–è¾‘æŒ‰é’®äº‹ä»¶
            const editBtn = contentElement.querySelector('.btn-edit-inspire');
            editBtn.addEventListener('click', () => {
                openEditInspireModal(todayInspiration);
            });
        }

        // åˆ·æ–°ä»Šæ—¥çµæ„Ÿ
        function refreshDailyInspiration() {
            if (!appState.inspires || appState.inspires.length <= 1) {
                showStatus('çµæ„Ÿè®°å½•ä¸è¶³ï¼Œæ— æ³•æ›´æ¢', 'error');
                return;
            }

            const contentElement = document.getElementById('dailyInspirationContent');
            const currentContentText = contentElement.querySelector('.inspire-content-text')?.textContent || contentElement.textContent;

            // éšæœºé€‰æ‹©ä¸€ä¸ªä¸å½“å‰ä¸åŒçš„çµæ„Ÿ
            let newIndex;
            do {
                newIndex = Math.floor(Math.random() * appState.inspires.length);
            } while (appState.inspires[newIndex].content === currentContentText);

            // é‡æ–°æ˜¾ç¤ºçµæ„Ÿå†…å®¹å’Œç¼–è¾‘æŒ‰é’®
            const newInspire = appState.inspires[newIndex];
            contentElement.innerHTML = `
                <div class="inspire-content-text">${newInspire.content}</div>
                <button class="btn-edit-inspire" data-id="${newInspire.id}" title="ç¼–è¾‘æ­¤çµæ„Ÿ">âœï¸ ç¼–è¾‘</button>
            `;

            // ç»‘å®šç¼–è¾‘æŒ‰é’®äº‹ä»¶
            const editBtn = contentElement.querySelector('.btn-edit-inspire');
            editBtn.addEventListener('click', () => {
                openEditInspireModal(newInspire);
            });

            showStatus('å·²æ›´æ¢ä»Šæ—¥çµæ„Ÿ', 'success');
        }

        // é‡Œç¨‹ç¢‘ç›¸å…³åŠŸèƒ½
        async function loadMilestones() {
            if (!appState.supabase) return;

            try {
                const { data, error } = await appState.supabase
                    .from('milestones')
                    .select('*')
                    .order('date', { ascending: false });

                if (error) {
                    console.log('é‡Œç¨‹ç¢‘è¡¨ä¸å­˜åœ¨æˆ–åŠ è½½å¤±è´¥');
                    return;
                }

                appState.milestones = data || [];
                displayMilestones();
            } catch (error) {
                console.error('åŠ è½½é‡Œç¨‹ç¢‘æ•°æ®å¤±è´¥:', error);
            }
        }

        function displayMilestones() {
            const milestoneList = document.getElementById('milestoneList');

            if (!appState.milestones || appState.milestones.length === 0) {
                milestoneList.innerHTML = '<div class="empty-milestone">æš‚æ— é‡Œç¨‹ç¢‘è®°å½•</div>';
                return;
            }

            milestoneList.innerHTML = appState.milestones.map(milestone => {
                const dateStr = formatDate(milestone.date);
                return `
                    <div class="milestone-tag" data-id="${milestone.id}">
                        <span class="milestone-date">${dateStr}</span>
                        <span class="milestone-title">${milestone.title}</span>
                        <span class="delete-milestone" data-id="${milestone.id}">Ã—</span>
                    </div>
                `;
            }).join('');

            // ç»‘å®šç‚¹å‡»äº‹ä»¶
            document.querySelectorAll('.milestone-tag').forEach(tag => {
                tag.addEventListener('click', function(e) {
                    const id = this.dataset.id;
                    const milestone = appState.milestones.find(m => m.id == id);
                    if (milestone && !e.target.classList.contains('delete-milestone')) {
                        showMilestoneDetail(milestone);
                    }
                });
            });

            // ç»‘å®šåˆ é™¤æŒ‰é’®äº‹ä»¶
            document.querySelectorAll('.delete-milestone').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    const id = this.dataset.id;
                    if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªé‡Œç¨‹ç¢‘å—ï¼Ÿ')) {
                        deleteMilestone(id);
                    }
                });
            });
        }

        function formatDate(dateStr) {
            const date = new Date(dateStr);
            const year = date.getFullYear();
            const month = date.getMonth() + 1;
            const day = date.getDate();
            return `${year}å¹´${month}æœˆ${day}æ—¥`;
        }

        function openMilestoneModal() {
            document.getElementById('milestoneModal').classList.add('show');
            document.getElementById('milestoneModalTitle').textContent = 'æ–°å¢é‡Œç¨‹ç¢‘';
            document.getElementById('milestoneTitle').value = '';
            document.getElementById('milestoneDate').value = '';
            document.getElementById('milestoneDesc').value = '';
            appState.currentEditingMilestone = null;
        }

        function closeMilestoneModal() {
            document.getElementById('milestoneModal').classList.remove('show');
            appState.currentEditingMilestone = null;
        }

        async function saveMilestone() {
            if (!appState.supabase) {
                alert('è¯·å…ˆè¿æ¥Supabase');
                return;
            }

            const title = document.getElementById('milestoneTitle').value.trim();
            const date = document.getElementById('milestoneDate').value;
            const desc = document.getElementById('milestoneDesc').value.trim();

            if (!title || !date) {
                alert('è¯·å¡«å†™é‡Œç¨‹ç¢‘äº‹ä»¶å’Œæ—¥æœŸ');
                return;
            }

            try {
                if (appState.currentEditingMilestone) {
                    // ç¼–è¾‘æ¨¡å¼
                    const { error } = await appState.supabase
                        .from('milestones')
                        .update({ 
                            title, 
                            date, 
                            description: desc,
                            desc: desc 
                        })
                        .eq('id', appState.currentEditingMilestone.id);

                    if (error) throw error;

                    showStatus('é‡Œç¨‹ç¢‘å·²æ›´æ–°', 'success');
                } else {
                    // æ–°å¢æ¨¡å¼
                    const { error } = await appState.supabase
                        .from('milestones')
                        .insert([{ 
                            title, 
                            date, 
                            description: desc,
                            desc: desc 
                        }]);

                    if (error) throw error;

                    showStatus('é‡Œç¨‹ç¢‘å·²ä¿å­˜', 'success');
                }

                closeMilestoneModal();
                await loadMilestones();
            } catch (error) {
                showStatus('ä¿å­˜å¤±è´¥ï¼š' + error.message, 'error');
                console.error('ä¿å­˜é‡Œç¨‹ç¢‘å¤±è´¥:', error);
            }
        }

        async function deleteMilestone(id) {
            if (!appState.supabase) return;

            try {
                const { error } = await appState.supabase
                    .from('milestones')
                    .delete()
                    .eq('id', id);

                if (error) throw error;

                showStatus('é‡Œç¨‹ç¢‘å·²åˆ é™¤', 'success');
                await loadMilestones();
            } catch (error) {
                showStatus('åˆ é™¤å¤±è´¥ï¼š' + error.message, 'error');
                console.error('åˆ é™¤é‡Œç¨‹ç¢‘å¤±è´¥:', error);
            }
        }

        function showMilestoneDetail(milestone) {
            document.getElementById('milestoneDetailModal').classList.add('show');
            document.getElementById('milestoneDetailTitle').textContent = milestone.title;
            document.getElementById('milestoneDetailDate').textContent = formatDate(milestone.date);
            document.getElementById('milestoneDetailDesc').textContent = milestone.description || milestone.desc || 'æš‚æ— æè¿°';
            appState.currentEditingMilestone = milestone;
        }

        function closeMilestoneDetail() {
            document.getElementById('milestoneDetailModal').classList.remove('show');
            appState.currentEditingMilestone = null;
        }

        function editMilestone() {
            if (!appState.currentEditingMilestone) return;

            const milestone = appState.currentEditingMilestone;
            closeMilestoneDetail();

            document.getElementById('milestoneModal').classList.add('show');
            document.getElementById('milestoneModalTitle').textContent = 'ç¼–è¾‘é‡Œç¨‹ç¢‘';
            document.getElementById('milestoneTitle').value = milestone.title;
            document.getElementById('milestoneDate').value = milestone.date;
            document.getElementById('milestoneDesc').value = milestone.desc || milestone.description || '';
        }

        async function deleteMilestoneFromDetail() {
            if (!appState.currentEditingMilestone) return;

            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªé‡Œç¨‹ç¢‘å—ï¼Ÿ')) {
                await deleteMilestone(appState.currentEditingMilestone.id);
                closeMilestoneDetail();
            }
        }

        // ä¿å­˜æ‰“å¡
        async function saveCheckin() {
            if (!appState.supabase) {
                alert('è¯·å…ˆè¿æ¥Supabase');
                return;
            }

            const mood = parseInt(document.getElementById('moodSlider').value);
            const note = document.getElementById('note').value.trim();
            const dateStr = appState.selectedDate.toISOString().split('T')[0];

            try {
                const { error } = await appState.supabase
                    .from('checkins')
                    .insert({
                        date: dateStr,
                        mood: mood,
                        note: note,
                        created_at: new Date().toISOString()
                    });

                if (error) throw error;

                await loadCheckins();
                closeModal();
                showStatus('âœ… æ‰“å¡æˆåŠŸï¼', 'success');
            } catch (error) {
                console.error('ä¿å­˜å¤±è´¥:', error);
                alert('ä¿å­˜å¤±è´¥ï¼š' + error.message);
            }
        }

        // åˆ é™¤æ‰“å¡
        async function deleteCheckin() {
            if (!appState.supabase || !appState.selectedDate) return;

            const dateStr = appState.selectedDate.toISOString().split('T')[0];

            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡æ‰“å¡è®°å½•å—ï¼Ÿ')) return;

            try {
                const { error } = await appState.supabase
                    .from('checkins')
                    .delete()
                    .eq('date', dateStr);

                if (error) throw error;

                await loadCheckins();
                closeModal();
                showStatus('âœ… å·²åˆ é™¤æ‰“å¡è®°å½•', 'success');
            } catch (error) {
                console.error('åˆ é™¤å¤±è´¥:', error);
                alert('åˆ é™¤å¤±è´¥ï¼š' + error.message);
            }
        }

        // ä¿å­˜ç¼–è¾‘åçš„å¤‡æ³¨
        async function saveEditNote() {
            if (!appState.supabase || !appState.selectedDate) return;

            const note = document.getElementById('editNoteInput').value.trim();
            const dateStr = appState.selectedDate.toISOString().split('T')[0];

            try {
                const { error } = await appState.supabase
                    .from('checkins')
                    .update({ note: note })
                    .eq('date', dateStr);

                if (error) throw error;

                await loadCheckins();
                closeEditSection();
                showStatus('âœ… å¤‡æ³¨å·²æ›´æ–°', 'success');
            } catch (error) {
                console.error('æ›´æ–°å¤±è´¥:', error);
                alert('æ›´æ–°å¤±è´¥ï¼š' + error.message);
            }
        }

        // æ‰“å¼€çµæ„Ÿæ¨¡æ€æ¡†
        function openInspireModal() {
            if (!appState.isConnected) {
                alert('è¯·å…ˆè¿æ¥ Supabase æ‰èƒ½è®°å½•çµæ„Ÿï¼');
                const configSection = document.getElementById('configSection');
                configSection.classList.add('show');
                return;
            }

            document.getElementById('inspireContent').value = '';
            document.getElementById('inspireModalTitle').textContent = 'è®°å½•çµæ„Ÿ';
            document.getElementById('saveInspireBtn').textContent = 'ä¿å­˜çµæ„Ÿ';
            appState.currentEditingInspire = null;
            document.getElementById('inspireModal').classList.add('show');
        }

        function openEditInspireModal(inspire) {
            document.getElementById('inspireContent').value = inspire.content;
            document.getElementById('inspireModalTitle').textContent = 'ç¼–è¾‘çµæ„Ÿ';
            document.getElementById('saveInspireBtn').textContent = 'æ›´æ–°çµæ„Ÿ';
            appState.currentEditingInspire = inspire;
            document.getElementById('inspireModal').classList.add('show');
        }

        // å…³é—­çµæ„Ÿæ¨¡æ€æ¡†
        function closeInspireModal() {
            document.getElementById('inspireModal').classList.remove('show');
            appState.currentEditingInspire = null;
        }

        // ä¿å­˜çµæ„Ÿ
        async function saveInspire() {
            if (!appState.supabase) {
                alert('è¯·å…ˆè¿æ¥Supabase');
                return;
            }

            const content = document.getElementById('inspireContent').value.trim();
            
            if (!content) {
                alert('è¯·è¾“å…¥å¯å‘å†…å®¹');
                return;
            }

            try {
                if (appState.currentEditingInspire) {
                    // ç¼–è¾‘æ¨¡å¼
                    const { error } = await appState.supabase
                        .from('inspires')
                        .update({
                            content: content
                        })
                        .eq('id', appState.currentEditingInspire.id);

                    if (error) throw error;

                    showStatus('âœ… çµæ„Ÿå·²æ›´æ–°ï¼', 'success');
                } else {
                    // æ–°å¢æ¨¡å¼
                    const { error } = await appState.supabase
                        .from('inspires')
                        .insert({
                            content: content,
                            created_at: new Date().toISOString()
                        });

                    if (error) throw error;

                    showStatus('âœ… çµæ„Ÿå·²ä¿å­˜ï¼', 'success');
                }

                await loadInspires();
                displayDailyInspiration(); // ä¿å­˜åæ›´æ–°ä»Šæ—¥çµæ„Ÿæ˜¾ç¤º
                closeInspireModal();
            } catch (error) {
                console.error('ä¿å­˜å¤±è´¥:', error);
                alert('ä¿å­˜å¤±è´¥ï¼š' + error.message);
            }
        }

        // æ‰“å¼€æ‰“å¡æ¨¡æ€æ¡†
        function openCheckinModal(date) {
            if (!appState.isConnected) {
                alert('è¯·å…ˆè¿æ¥ Supabase æ‰èƒ½æ‰“å¡ï¼');
                const configSection = document.getElementById('configSection');
                configSection.classList.add('show');
                return;
            }

            appState.selectedDate = date;
            const dateStr = date.toISOString().split('T')[0];

            // æ£€æŸ¥æ˜¯å¦å·²æœ‰æ‰“å¡
            const existingCheckin = appState.checkins.find(c => c.date === dateStr);

            if (existingCheckin) {
                // æ˜¾ç¤ºè¯¦æƒ…
                document.getElementById('modalTitle').textContent = 'æ‰“å¡è¯¦æƒ…';
                document.getElementById('checkinForm').style.display = 'none';
                document.getElementById('checkinDetail').style.display = 'block';
                document.getElementById('editNoteSection').style.display = 'none';
                document.getElementById('detailMood').textContent = existingCheckin.mood;
                document.getElementById('detailText').textContent = existingCheckin.note || 'æ— ';
                document.getElementById('detailTime').textContent = new Date(existingCheckin.created_at).toLocaleString('zh-CN');
            } else {
                // æ˜¾ç¤ºè¡¨å•
                document.getElementById('modalTitle').textContent = 'æ‰“å¡';
                document.getElementById('checkinForm').style.display = 'block';
                document.getElementById('checkinDetail').style.display = 'none';
                document.getElementById('editNoteSection').style.display = 'none';
                document.getElementById('moodSlider').value = 50;
                document.getElementById('note').value = '';
                updateMoodDisplay();
            }

            document.getElementById('checkinModal').classList.add('show');
        }

        // å…³é—­æ¨¡æ€æ¡†
        function closeModal() {
            document.getElementById('checkinModal').classList.remove('show');
            appState.selectedDate = null;
        }

        // æ‰“å¼€ç¼–è¾‘å¤‡æ³¨åŒºåŸŸ
        function openEditSection() {
            const existingCheckin = appState.checkins.find(c => c.date === appState.selectedDate.toISOString().split('T')[0]);
            if (existingCheckin) {
                document.getElementById('editNoteInput').value = existingCheckin.note || '';
                document.getElementById('checkinDetail').style.display = 'none';
                document.getElementById('editNoteSection').style.display = 'block';
            }
        }

        // å…³é—­ç¼–è¾‘å¤‡æ³¨åŒºåŸŸ
        function closeEditSection() {
            document.getElementById('editNoteSection').style.display = 'none';
            document.getElementById('checkinDetail').style.display = 'block';
        }

        // æ›´æ–°å¿ƒæƒ…æ˜¾ç¤º
        function updateMoodDisplay() {
            const value = document.getElementById('moodSlider').value;
            document.getElementById('moodValue').textContent = value;

            let emoji = 'ğŸ˜';
            if (value <= 20) emoji = 'ğŸ˜¢';
            else if (value <= 40) emoji = 'ğŸ˜•';
            else if (value <= 60) emoji = 'ğŸ˜';
            else if (value <= 80) emoji = 'ğŸ˜Š';
            else emoji = 'ğŸ˜„';

            document.getElementById('moodEmoji').textContent = emoji;
        }

        // è·å–èŠ‚å‡æ—¥åç§°
        function getHolidayName(month, day) {
            for (const [name, holiday] of Object.entries(holidays2026)) {
                const start = new Date(2026, holiday.start.month, holiday.start.day);
                const end = new Date(2026, holiday.end.month, holiday.end.day);
                const current = new Date(2026, month, day);
                if (current >= start && current <= end) {
                    return holiday.name;
                }
            }
            return null;
        }

        // åˆ¤æ–­æ˜¯å¦æ˜¯èŠ‚å‡æ—¥
        function isHoliday(month, day) {
            return getHolidayName(month, day) !== null;
        }

        // åˆ¤æ–­æ˜¯å¦æ˜¯è°ƒä¼‘å·¥ä½œæ—¥
        function isWorkdayAdjustment(month, day) {
            for (const holiday of Object.values(holidays2026)) {
                const beforeDays = holiday.workDaysBefore || [];
                const afterDays = holiday.workDaysAfter || [];

                for (const d of [...beforeDays, ...afterDays]) {
                    if (d.month === month && d.day === day) {
                        return true;
                    }
                }
            }
            return false;
        }

        // åˆ¤æ–­æ˜¯å¦æ˜¯å·¥ä½œæ—¥
        function isWorkday(date) {
            const day = date.getDay();
            const month = date.getMonth();
            const dayOfMonth = date.getDate();

            // å‘¨æœ«ä½†è°ƒä¼‘å·¥ä½œæ—¥
            if ((day === 0 || day === 6) && isWorkdayAdjustment(month, dayOfMonth)) {
                return true;
            }

            // å‘¨æœ«ï¼ˆéè°ƒä¼‘ï¼‰
            if (day === 0 || day === 6) {
                return false;
            }

            // å·¥ä½œæ—¥ä½†èŠ‚å‡æ—¥
            if (isHoliday(month, dayOfMonth)) {
                return false;
            }

            return true;
        }

        // è®¡ç®—å·¥ä½œæ—¥å€’è®¡æ—¶
        function calculateWorkdays() {
            const today = new Date();
            const targetDate = new Date(2026, 5, 12); // 6æœˆ12æ—¥

            if (today > targetDate) return { workdays: 0, weeks: 0 };

            let workdays = 0;
            let current = new Date(today);
            current.setDate(current.getDate() + 1); // ä»æ˜å¤©å¼€å§‹è®¡ç®—

            while (current < targetDate) {
                if (isWorkday(current)) {
                    workdays++;
                }
                current.setDate(current.getDate() + 1);
            }

            // è®¡ç®—å‰©ä½™å‘¨æ•°ï¼ˆå®Œæ•´å‘¨ï¼‰
            const daysDiff = Math.floor((targetDate - today) / (1000 * 60 * 60 * 24));
            const weeks = Math.ceil(daysDiff / 7);

            return { workdays, weeks };
        }

        // æ›´æ–°å€’è®¡æ—¶
        function updateCountdown() {
            const { workdays, weeks } = calculateWorkdays();
            document.getElementById('countdown').textContent = workdays;
            document.getElementById('countdownExtra').textContent = `å‰©ä½™å‘¨æ•°ï¼š${weeks}å‘¨`;

            const today = new Date();
            const options = { year: 'numeric', month: 'long', day: 'numeric', weekday: 'long' };
            document.getElementById('currentDate').textContent = today.toLocaleDateString('zh-CN', options);
        }

        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        function updateStats() {
            const total = appState.checkins.length;
            const avg = total > 0 ? Math.round(appState.checkins.reduce((sum, c) => sum + c.mood, 0) / total) : 0;
            const streak = calculateStreak();

            document.getElementById('totalCheckins').textContent = total;
            document.getElementById('avgMood').textContent = avg;
            document.getElementById('streak').textContent = streak;
        }

        // è®¡ç®—è¿ç»­æ‰“å¡å¤©æ•°
        function calculateStreak() {
            if (appState.checkins.length === 0) return 0;

            const today = new Date();
            const sortedDates = appState.checkins
                .map(c => new Date(c.date))
                .sort((a, b) => b - a);

            let streak = 0;
            let currentDate = new Date(today);

            for (const checkinDate of sortedDates) {
                const diffDays = Math.floor((currentDate - checkinDate) / (1000 * 60 * 60 * 24));

                if (diffDays <= 1) {
                    streak++;
                    currentDate = new Date(checkinDate);
                    currentDate.setDate(currentDate.getDate() - 1);
                } else {
                    break;
                }
            }

            return streak;
        }

        // ç”Ÿæˆå•æœˆæ—¥å†
        function generateMonthCalendar(month) {
            const year = 2026;
            // è®¡ç®—è¯¥æœˆç¬¬ä¸€å¤©æ˜¯å‘¨å‡ ï¼ˆä»¥å‘¨ä¸€ä¸ºç¬¬ä¸€å‘¨çš„å¼€å§‹ï¼‰
            const firstDay = new Date(year, month, 1);
            let firstDayOfWeek = firstDay.getDay(); // 0=å‘¨æ—¥, 1=å‘¨ä¸€, ..., 6=å‘¨å…­
            // è½¬æ¢ä¸ºï¼šå‘¨ä¸€=0, å‘¨äºŒ=1, ..., å‘¨æ—¥=6
            firstDayOfWeek = firstDayOfWeek === 0 ? 6 : firstDayOfWeek - 1;

            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const monthNames = ['ä¸€æœˆ', 'äºŒæœˆ', 'ä¸‰æœˆ', 'å››æœˆ', 'äº”æœˆ', 'å…­æœˆ', 'ä¸ƒæœˆ', 'å…«æœˆ', 'ä¹æœˆ', 'åæœˆ', 'åä¸€æœˆ', 'åäºŒæœˆ'];

            let html = `
                <div class="month-card">
                    <div class="month-title">${monthNames[month]}</div>
                    <div class="days-grid">
            `;

            // æ˜ŸæœŸæ ‡é¢˜ï¼ˆä»å‘¨ä¸€å¼€å§‹ï¼‰
            const weekDays = ['ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­', 'æ—¥'];
            weekDays.forEach(day => {
                html += `<div class="day" style="font-weight: 600; color: #667eea; cursor: default;">${day}</div>`;
            });

            // ç©ºç™½æ—¥æœŸ
            for (let i = 0; i < firstDayOfWeek; i++) {
                html += `<div class="day other-month"></div>`;
            }

            // æ—¥æœŸ
            const today = new Date();
            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(year, month, day);
                const dateStr = date.toISOString().split('T')[0];
                const dayOfWeek = date.getDay();
                const dayOfMonth = date.getDate();

                let className = 'day';

                // åˆ¤æ–­æ—¥æœŸç±»å‹ï¼ˆç¡®ä¿è°ƒä¼‘å’ŒèŠ‚å‡æ—¥æ ·å¼ä¼˜å…ˆçº§æ­£ç¡®ï¼‰
                const holidayName = getHolidayName(month, dayOfMonth);
                const isWorkdayAdjust = isWorkdayAdjustment(month, dayOfMonth);

                if (today.getFullYear() === year && today.getMonth() === month && today.getDate() === day) {
                    className += ' today';
                } else if (holidayName) {
                    className += ' holiday';
                } else if (isWorkdayAdjust) {
                    className += ' workday-adjust';
                } else if (dayOfWeek === 0 || dayOfWeek === 6) {
                    className += ' weekend';
                }

                // æ£€æŸ¥æ˜¯å¦æœ‰æ‰“å¡
                const checkin = appState.checkins.find(c => c.date === dateStr);
                if (checkin) {
                    className += ' checked-in';
                }

                // è·å–èŠ‚å‡æ—¥åç§°æˆ–è°ƒä¼‘æ ‡è®°
                let dayTag = '';
                if (holidayName) {
                    dayTag = `<span class="day-tag">${holidayName}</span>`;
                } else if (isWorkdayAdjustment(month, dayOfMonth)) {
                    dayTag = `<span class="day-tag">ç­</span>`;
                }

                // ä»…æ˜¾ç¤ºåˆ†æ•°å€¼ï¼Œä¸æ˜¾ç¤º"åˆ†"å­—ï¼Œä¸æ˜¾ç¤ºemoji
                const moodScore = checkin ? `<span class="mood-score">${checkin.mood}</span>` : '';

                html += `
                    <div class="${className}" data-date="${dateStr}">
                        ${dayTag}
                        <span class="day-number">${day}</span>
                        ${moodScore}
                    </div>
                `;
            }

            html += `
                    </div>
                </div>
            `;

            return html;
        }

        // æ¸²æŸ“å½“å‰æœˆä»½æ—¥å†
        function renderCalendar() {
            const monthNames = ['ä¸€æœˆ', 'äºŒæœˆ', 'ä¸‰æœˆ', 'å››æœˆ', 'äº”æœˆ', 'å…­æœˆ', 'ä¸ƒæœˆ', 'å…«æœˆ', 'ä¹æœˆ', 'åæœˆ', 'åä¸€æœˆ', 'åäºŒæœˆ'];

            // æ›´æ–°æ ‡é¢˜
            document.getElementById('calendarTitle').textContent = `${appState.currentYear}å¹´${monthNames[appState.currentMonth]}`;
            document.getElementById('monthTitle').textContent = monthNames[appState.currentMonth];

            // ç”Ÿæˆæ—¥å†HTML
            const daysGrid = document.getElementById('daysGrid');
            daysGrid.innerHTML = generateMonthDays(appState.currentYear, appState.currentMonth);

            // æ›´æ–°å¯¼èˆªæŒ‰é’®çŠ¶æ€
            updateNavButtons();

            // æ·»åŠ ç‚¹å‡»äº‹ä»¶
            document.querySelectorAll('.day[data-date]').forEach(dayElement => {
                dayElement.addEventListener('click', function() {
                    const dateStr = this.getAttribute('data-date');
                    const date = new Date(dateStr);
                    openCheckinModal(date);
                });
            });
        }

        // ç”Ÿæˆå•æœˆæ—¥å†çš„æ—¥æœŸéƒ¨åˆ†
        function generateMonthDays(year, month) {
            // è®¡ç®—è¯¥æœˆç¬¬ä¸€å¤©æ˜¯å‘¨å‡ ï¼ˆä»¥å‘¨ä¸€ä¸ºç¬¬ä¸€å‘¨çš„å¼€å§‹ï¼‰
            const firstDay = new Date(year, month, 1);
            let firstDayOfWeek = firstDay.getDay(); // 0=å‘¨æ—¥, 1=å‘¨ä¸€, ..., 6=å‘¨å…­
            // è½¬æ¢ä¸ºï¼šå‘¨ä¸€=0, å‘¨äºŒ=1, ..., å‘¨æ—¥=6
            firstDayOfWeek = firstDayOfWeek === 0 ? 6 : firstDayOfWeek - 1;

            const daysInMonth = new Date(year, month + 1, 0).getDate();

            let html = '';

            // æ˜ŸæœŸæ ‡é¢˜ï¼ˆä»å‘¨ä¸€å¼€å§‹ï¼‰
            const weekDays = ['ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­', 'æ—¥'];
            weekDays.forEach(day => {
                html += `<div class="day" style="font-weight: 600; color: #667eea; cursor: default;">${day}</div>`;
            });

            // ç©ºç™½æ—¥æœŸ
            for (let i = 0; i < firstDayOfWeek; i++) {
                html += `<div class="day other-month"></div>`;
            }

            // æ—¥æœŸ
            const today = new Date();
            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(year, month, day);
                const dateStr = date.toISOString().split('T')[0];
                const dayOfWeek = date.getDay();
                const dayOfMonth = date.getDate();

                let className = 'day';

                // åˆ¤æ–­æ—¥æœŸç±»å‹ï¼ˆç¡®ä¿è°ƒä¼‘å’ŒèŠ‚å‡æ—¥æ ·å¼ä¼˜å…ˆçº§æ­£ç¡®ï¼‰
                const holidayName = getHolidayName(month, dayOfMonth);
                const isWorkdayAdjust = isWorkdayAdjustment(month, dayOfMonth);

                if (today.getFullYear() === year && today.getMonth() === month && today.getDate() === day) {
                    className += ' today';
                } else if (holidayName) {
                    className += ' holiday';
                } else if (isWorkdayAdjust) {
                    className += ' workday-adjust';
                } else if (dayOfWeek === 0 || dayOfWeek === 6) {
                    className += ' weekend';
                }

                // æ£€æŸ¥æ˜¯å¦æœ‰æ‰“å¡
                const checkin = appState.checkins.find(c => c.date === dateStr);
                if (checkin) {
                    className += ' checked-in';
                }

                // è·å–èŠ‚å‡æ—¥åç§°æˆ–è°ƒä¼‘æ ‡è®°
                let dayTag = '';
                if (holidayName) {
                    dayTag = `<span class="day-tag">${holidayName}</span>`;
                } else if (isWorkdayAdjustment(month, dayOfMonth)) {
                    dayTag = `<span class="day-tag">ç­</span>`;
                }

                // ä»…æ˜¾ç¤ºåˆ†æ•°å€¼ï¼Œä¸æ˜¾ç¤º"åˆ†"å­—ï¼Œä¸æ˜¾ç¤ºemoji
                const moodScore = checkin ? `<span class="mood-score">${checkin.mood}</span>` : '';

                html += `
                    <div class="${className}" data-date="${dateStr}">
                        ${dayTag}
                        <span class="day-number">${day}</span>
                        ${moodScore}
                    </div>
                `;
            }

            return html;
        }

        // æ›´æ–°å¯¼èˆªæŒ‰é’®çŠ¶æ€
        function updateNavButtons() {
            const prevBtn = document.getElementById('prevMonthBtn');
            const nextBtn = document.getElementById('nextMonthBtn');

            // é™åˆ¶åªæ˜¾ç¤º2æœˆåˆ°6æœˆï¼ˆç´¢å¼•1åˆ°5ï¼‰
            prevBtn.disabled = appState.currentMonth <= 1;
            nextBtn.disabled = appState.currentMonth >= 5;
        }

        // ä¸Šä¸ªæœˆ
        function goToPrevMonth() {
            if (appState.currentMonth > 1) {
                // æ·»åŠ æ»‘åŠ¨åŠ¨ç”»
                const slide = document.getElementById('calendarSlide');
                slide.style.transition = 'transform 0.3s ease-out';
                slide.style.transform = 'translateX(30px)';
                slide.style.opacity = '0.3';

                setTimeout(() => {
                    appState.currentMonth--;
                    renderCalendar();

                    // é‡ç½®åŠ¨ç”»
                    slide.style.transition = 'none';
                    slide.style.transform = 'translateX(-30px)';
                    slide.style.opacity = '0.3';

                    setTimeout(() => {
                        slide.style.transition = 'transform 0.3s ease-out, opacity 0.3s ease-out';
                        slide.style.transform = 'translateX(0)';
                        slide.style.opacity = '1';
                    }, 50);
                }, 200);
            }
        }

        // ä¸‹ä¸ªæœˆ
        function goToNextMonth() {
            if (appState.currentMonth < 5) {
                // æ·»åŠ æ»‘åŠ¨åŠ¨ç”»
                const slide = document.getElementById('calendarSlide');
                slide.style.transition = 'transform 0.3s ease-out';
                slide.style.transform = 'translateX(-30px)';
                slide.style.opacity = '0.3';

                setTimeout(() => {
                    appState.currentMonth++;
                    renderCalendar();

                    // é‡ç½®åŠ¨ç”»
                    slide.style.transition = 'none';
                    slide.style.transform = 'translateX(30px)';
                    slide.style.opacity = '0.3';

                    setTimeout(() => {
                        slide.style.transition = 'transform 0.3s ease-out, opacity 0.3s ease-out';
                        slide.style.transform = 'translateX(0)';
                        slide.style.opacity = '1';
                    }, 50);
                }, 200);
            }
        }

        // è§¦æ‘¸æ»‘åŠ¨æ”¯æŒ
        function initTouchEvents() {
            const container = document.getElementById('calendarContainer');

            container.addEventListener('touchstart', function(e) {
                appState.touchStartX = e.changedTouches[0].screenX;
            }, { passive: true });

            container.addEventListener('touchend', function(e) {
                appState.touchEndX = e.changedTouches[0].screenX;
                handleSwipe();
            }, { passive: true });
        }

        // å¤„ç†æ»‘åŠ¨
        function handleSwipe() {
            const swipeThreshold = 50; // æ»‘åŠ¨é˜ˆå€¼
            const diff = appState.touchStartX - appState.touchEndX;

            if (Math.abs(diff) > swipeThreshold) {
                if (diff > 0) {
                    // å·¦æ»‘ï¼Œä¸‹ä¸ªæœˆ
                    goToNextMonth();
                } else {
                    // å³æ»‘ï¼Œä¸Šä¸ªæœˆ
                    goToPrevMonth();
                }
            }
        }

        // æ˜¾ç¤ºé…ç½®é¢æ¿
        function showConfigPanel() {
            const configSection = document.getElementById('configSection');
            configSection.classList.toggle('show');

            // é¢„å¡«å……å½“å‰é…ç½®
            const config = getSupabaseConfig();
            document.getElementById('supabaseUrl').value = config.url;
            document.getElementById('supabaseKey').value = config.key;
        }

        // ä¿å­˜é…ç½®å¹¶é‡æ–°è¿æ¥
        async function saveAndReconnect() {
            const url = document.getElementById('supabaseUrl').value.trim();
            const key = document.getElementById('supabaseKey').value.trim();

            if (!url || !key) {
                alert('è¯·è¾“å…¥Supabase URLå’ŒKey');
                return;
            }

            await connectSupabase(url, key);
        }

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            // ç»‘å®šäº‹ä»¶
            document.getElementById('settingsBtn').addEventListener('click', showConfigPanel);
            document.getElementById('saveConfigBtn').addEventListener('click', saveAndReconnect);
            document.getElementById('cancelConfigBtn').addEventListener('click', function() {
                const configSection = document.getElementById('configSection');
                configSection.classList.remove('show');
            });
            document.getElementById('closeModalBtn').addEventListener('click', closeModal);
            document.getElementById('cancelBtn').addEventListener('click', closeModal);
            document.getElementById('saveCheckinBtn').addEventListener('click', saveCheckin);
            document.getElementById('deleteCheckinBtn').addEventListener('click', deleteCheckin);
            document.getElementById('closeDetailBtn').addEventListener('click', closeModal);
            document.getElementById('editNoteBtn').addEventListener('click', openEditSection);
            document.getElementById('cancelEditBtn').addEventListener('click', closeEditSection);
            document.getElementById('saveEditBtn').addEventListener('click', saveEditNote);
            document.getElementById('moodSlider').addEventListener('input', updateMoodDisplay);
            
            // ç»‘å®šè¢«å¯å‘åŠŸèƒ½äº‹ä»¶
            document.getElementById('inspireBtn').addEventListener('click', openInspireModal);
            document.getElementById('closeInspireModalBtn').addEventListener('click', closeInspireModal);
            document.getElementById('cancelInspireBtn').addEventListener('click', closeInspireModal);
            document.getElementById('saveInspireBtn').addEventListener('click', saveInspire);
            document.getElementById('refreshInspireBtn').addEventListener('click', refreshDailyInspiration);

            // é‡Œç¨‹ç¢‘ç›¸å…³äº‹ä»¶ç›‘å¬
            document.getElementById('addMilestoneBtn').addEventListener('click', openMilestoneModal);
            document.getElementById('closeMilestoneModalBtn').addEventListener('click', closeMilestoneModal);
            document.getElementById('cancelMilestoneBtn').addEventListener('click', closeMilestoneModal);
            document.getElementById('saveMilestoneBtn').addEventListener('click', saveMilestone);

            // é‡Œç¨‹ç¢‘è¯¦æƒ…ç›¸å…³äº‹ä»¶ç›‘å¬
            document.getElementById('closeMilestoneDetailBtn').addEventListener('click', closeMilestoneDetail);
            document.getElementById('closeMilestoneDetailBtn2').addEventListener('click', closeMilestoneDetail);
            document.getElementById('editMilestoneBtn').addEventListener('click', editMilestone);
            document.getElementById('deleteMilestoneBtn').addEventListener('click', deleteMilestoneFromDetail);

            // ç‚¹å‡»æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
            document.getElementById('checkinModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeModal();
                }
            });

            // ç‚¹å‡»è¢«å¯å‘æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
            document.getElementById('inspireModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeInspireModal();
                }
            });

            // ç‚¹å‡»é‡Œç¨‹ç¢‘æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
            document.getElementById('milestoneModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeMilestoneModal();
                }
            });

            // ç‚¹å‡»é‡Œç¨‹ç¢‘è¯¦æƒ…æ¨¡æ€æ¡†å¤–éƒ¨å…³é—­
            document.getElementById('milestoneDetailModal').addEventListener('click', function(e) {
                if (e.target === this) {
                    closeMilestoneDetail();
                }
            });

            // ç»‘å®šæ—¥å†å¯¼èˆªæŒ‰é’®äº‹ä»¶
            document.getElementById('prevMonthBtn').addEventListener('click', goToPrevMonth);
            document.getElementById('nextMonthBtn').addEventListener('click', goToNextMonth);

            // åˆå§‹åŒ–è§¦æ‘¸æ»‘åŠ¨äº‹ä»¶
            initTouchEvents();

            // è®¾ç½®å½“å‰æœˆä»½ä¸ºä»Šå¤©æ‰€åœ¨çš„æœˆä»½
            const today = new Date();
            appState.currentYear = today.getFullYear();
            appState.currentMonth = today.getMonth();

            // æ¸²æŸ“æ—¥å†
            renderCalendar();

            // æ›´æ–°å€’è®¡æ—¶
            updateCountdown();

            // è‡ªåŠ¨è¿æ¥ Supabase
            const config = getSupabaseConfig();
            if (config.url && config.key && config.url !== 'https://your-project.supabase.co') {
                connectSupabase(config.url, config.key);
            } else {
                showStatus('è¯·ç‚¹å‡»"è®¾ç½® Supabase"é…ç½®è¿æ¥ä¿¡æ¯', 'error');
            }
        });
    })();
    </script>
</body>
</html>
