<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Health 2026 - ä¸ªäººèº«ä½“ç®¡ç†</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        * {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        }
        
        .card-shadow {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        }
        
        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .input-focus:focus {
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.3);
        }
        
        .metric-card {
            transition: all 0.2s ease;
        }
        
        .metric-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 12px -2px rgba(0, 0, 0, 0.1);
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- ä¸»å®¹å™¨ -->
    <div class="max-w-2xl mx-auto px-4 py-6">
        <!-- å¤´éƒ¨ -->
        <header class="text-center mb-6">
            <div class="flex items-center justify-center mb-2">
                <div class="w-10 h-10 gradient-bg rounded-xl flex items-center justify-center mr-3">
                    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"></path>
                    </svg>
                </div>
                <h1 class="text-2xl font-bold text-gray-800">Daily Health 2026</h1>
            </div>
            <p class="text-gray-500 text-sm">è®°å½•æ¯ä¸€å¤©ï¼Œé‡è§æ›´å¥½çš„è‡ªå·±</p>
            <a href="/FY2026.html">Free Yourself</a>
        </header>

        <!-- è§†å›¾åˆ‡æ¢å’Œæ—¥æœŸå¯¼èˆª -->
        <div class="bg-white rounded-2xl card-shadow p-4 mb-6">
            <!-- è§†å›¾åˆ‡æ¢ -->
            <div class="flex justify-center mb-4">
                <div class="inline-flex bg-gray-100 rounded-xl p-1">
                    <button onclick="switchView('day')" id="dayViewBtn" class="px-4 py-2 rounded-lg font-medium text-sm transition bg-white text-gray-800 shadow">
                        æ—¥è§†å›¾
                    </button>
                    <button onclick="switchView('week')" id="weekViewBtn" class="px-4 py-2 rounded-lg font-medium text-sm transition text-gray-600 hover:text-gray-800">
                        å‘¨è§†å›¾
                    </button>
                    <button onclick="switchView('month')" id="monthViewBtn" class="px-4 py-2 rounded-lg font-medium text-sm transition text-gray-600 hover:text-gray-800">
                        æœˆè§†å›¾
                    </button>
                </div>
            </div>

            <!-- æ—¥æœŸå¯¼èˆª -->
            <div class="flex items-center justify-between" id="dateNavigation">
                <button onclick="previousPeriod()" class="p-2 hover:bg-gray-100 rounded-xl transition" id="prevBtn">
                    <svg class="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
                    </svg>
                </button>

                <div class="text-center" id="dateDisplay">
                    <p class="text-lg font-semibold text-gray-800" id="currentDateText">åŠ è½½ä¸­...</p>
                    <p class="text-sm text-gray-500" id="currentWeekday"></p>
                </div>

                <button onclick="nextPeriod()" class="p-2 hover:bg-gray-100 rounded-xl transition" id="nextBtn">
                    <svg class="w-6 h-6 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
                    </svg>
                </button>
            </div>
        </div>

        <!-- ä»ªè¡¨æ¿ç»Ÿè®¡åŒºåŸŸ -->
        <div id="dashboardSection" class="mb-6 hidden">
            <div class="bg-white rounded-2xl card-shadow p-6">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-lg font-semibold text-gray-800" id="dashboardTitle">ç»Ÿè®¡æ•°æ®</h2>
                </div>
                
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4" id="dashboardMetrics">
                    <!-- ç»Ÿè®¡æŒ‡æ ‡å¡ç‰‡ä¼šåŠ¨æ€æ’å…¥è¿™é‡Œ -->
                </div>
            </div>
        </div>

        <!-- æ•°æ®å±•ç¤ºåŒºåŸŸ -->
        <div id="displaySection" class="mb-6 hidden">
            <div class="bg-white rounded-2xl card-shadow p-6">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-lg font-semibold text-gray-800">ä»Šæ—¥è®°å½•</h2>
                    <button onclick="editRecord()" class="text-blue-600 text-sm font-medium hover:text-blue-700 flex items-center">
                        <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                        </svg>
                        ç¼–è¾‘
                    </button>
                </div>
                
                <div class="grid grid-cols-2 gap-4" id="metricsDisplay">
                    <!-- æŒ‡æ ‡å¡ç‰‡ä¼šåŠ¨æ€æ’å…¥è¿™é‡Œ -->
                </div>
                
                <button onclick="deleteRecord()" class="mt-6 w-full py-3 border border-red-200 text-red-600 rounded-xl font-medium hover:bg-red-50 transition">
                    åˆ é™¤ä»Šæ—¥è®°å½•
                </button>
            </div>
        </div>

        <!-- æ•°æ®å½•å…¥è¡¨å• -->
        <div id="formSection" class="mb-6">
            <div class="bg-white rounded-2xl card-shadow p-6 fade-in">
                <h2 class="text-lg font-semibold text-gray-800 mb-6" id="formTitle">è®°å½•ä»Šæ—¥æ•°æ®</h2>
                
                <form id="healthForm" class="space-y-5">
                    <!-- ç¡çœ æ—¶é•¿ -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <span class="flex items-center">
                                <svg class="w-4 h-4 mr-2 text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path>
                                </svg>
                                ç¡çœ æ—¶é•¿
                            </span>
                        </label>
                        <input type="number" id="sleepHours" step="0.1" min="0" max="24" placeholder="ä¾‹å¦‚ï¼š7.5" 
                            class="w-full px-4 py-3 border border-gray-200 rounded-xl input-focus focus:outline-none focus:border-blue-500">
                    </div>
                    
                    <!-- å’–å•¡æ¯æ•° -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <span class="flex items-center">
                                <svg class="w-4 h-4 mr-2 text-amber-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 8h1a4 4 0 010 8h-1M2 8h16v9a4 4 0 01-4 4H6a4 4 0 01-4-4V8z"></path>
                                </svg>
                                å’–å•¡æ¯æ•°
                            </span>
                        </label>
                        <input type="number" id="coffeeCups" min="0" max="20" placeholder="ä¾‹å¦‚ï¼š2" 
                            class="w-full px-4 py-3 border border-gray-200 rounded-xl input-focus focus:outline-none focus:border-blue-500">
                    </div>
                    
                    <!-- å‹åŠ›å€¼ -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <span class="flex items-center">
                                <svg class="w-4 h-4 mr-2 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                                å¿ƒæ€å‹åŠ›å€¼ (1-10)
                            </span>
                        </label>
                        <div class="flex items-center space-x-4">
                            <input type="range" id="stressLevel" min="1" max="10" value="5" 
                                class="flex-1 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-red-500"
                                oninput="updateStressValue(this.value)">
                            <span id="stressValue" class="text-2xl font-bold text-red-500 w-8 text-center">5</span>
                        </div>
                        <div class="flex justify-between text-xs text-gray-400 mt-1">
                            <span>è½»æ¾</span>
                            <span>å‹åŠ›å¤§</span>
                        </div>
                    </div>
                    
                    <!-- å·¥ä½œæ—¶é•¿ -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <span class="flex items-center">
                                <svg class="w-4 h-4 mr-2 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"></path>
                                </svg>
                                å·¥ä½œæ—¶é•¿
                            </span>
                        </label>
                        <input type="number" id="workHours" step="0.5" min="0" max="24" placeholder="ä¾‹å¦‚ï¼š8" 
                            class="w-full px-4 py-3 border border-gray-200 rounded-xl input-focus focus:outline-none focus:border-blue-500">
                    </div>
                    
                    <!-- ä¿¯å§æ’‘ä¸ªæ•° -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <span class="flex items-center">
                                <svg class="w-4 h-4 mr-2 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 10h16M4 14h16M4 18h16"></path>
                                </svg>
                                ä¿¯å§æ’‘ä¸ªæ•°
                            </span>
                        </label>
                        <input type="number" id="pushups" min="0" placeholder="ä¾‹å¦‚ï¼š30" 
                            class="w-full px-4 py-3 border border-gray-200 rounded-xl input-focus focus:outline-none focus:border-blue-500">
                    </div>
                    
                    <!-- é”»ç‚¼æ—¶é•¿ -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <span class="flex items-center">
                                <svg class="w-4 h-4 mr-2 text-purple-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                                </svg>
                                é”»ç‚¼æ—¶é•¿ï¼ˆåˆ†é’Ÿï¼‰
                            </span>
                        </label>
                        <input type="number" id="exerciseMinutes" min="0" placeholder="ä¾‹å¦‚ï¼š45" 
                            class="w-full px-4 py-3 border border-gray-200 rounded-xl input-focus focus:outline-none focus:border-blue-500">
                    </div>
                    
                    <!-- æœ‰æ°§è¿åŠ¨ -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <span class="flex items-center">
                                <svg class="w-4 h-4 mr-2 text-teal-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"></path>
                                </svg>
                                æœ‰æ°§è¿åŠ¨
                            </span>
                        </label>
                        <div class="flex space-x-3">
                            <label class="flex-1 flex items-center justify-center px-4 py-3 border-2 border-gray-200 rounded-xl cursor-pointer hover:border-teal-500 transition" id="aerobicYes">
                                <input type="radio" name="aerobic" value="true" class="hidden" onchange="selectAerobic(true)">
                                <span class="text-gray-600" id="aerobicYesText">æ˜¯</span>
                            </label>
                            <label class="flex-1 flex items-center justify-center px-4 py-3 border-2 border-gray-200 rounded-xl cursor-pointer hover:border-teal-500 transition" id="aerobicNo">
                                <input type="radio" name="aerobic" value="false" class="hidden" onchange="selectAerobic(false)">
                                <span class="text-gray-600" id="aerobicNoText">å¦</span>
                            </label>
                        </div>
                    </div>
                    
                    <!-- æäº¤æŒ‰é’® -->
                    <button type="submit" class="w-full gradient-bg text-white py-4 rounded-xl font-semibold text-lg hover:opacity-90 transition mt-6">
                        ä¿å­˜è®°å½•
                    </button>
                    
                    <button type="button" onclick="cancelEdit()" id="cancelBtn" class="w-full py-3 border border-gray-200 text-gray-600 rounded-xl font-medium hover:bg-gray-50 transition hidden">
                        å–æ¶ˆç¼–è¾‘
                    </button>
                </form>
            </div>
        </div>

        <!-- çŠ¶æ€ä¿¡æ¯ -->
        <div class="text-center text-sm text-gray-400" id="statusInfo">
            <p>æ•°æ®å­˜å‚¨æ¨¡å¼ï¼š<span id="storageMode">æœªé…ç½®</span></p>
        </div>
        
        <!-- é‡æ–°é…ç½®æŒ‰é’® -->
        <div class="text-center mt-4">
            <button onclick="resetConfig()" class="text-sm text-blue-600 hover:text-blue-700">
                é‡æ–°é…ç½®æ•°æ®åº“
            </button>
        </div>
    </div>

    <script>
        // é¢„è®¾ Supabase é…ç½®
        const DEFAULT_SUPABASE_URL = 'https://bbmdviffgxarxuptfftp.supabase.co';
        const DEFAULT_SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJibWR2aWZmZ3hhcnh1cHRmZnRwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njk5MzgyNzEsImV4cCI6MjA4NTUxNDI3MX0.qqceYnTa7ZtD-Sl1JbNFs1l_0JStdTzrrIXiXv62k54';
        
        // é…ç½®å’ŒçŠ¶æ€å˜é‡
        let supabaseClient = null;
        let useSupabase = false;
        let currentDate = null;
        let currentDateStr = '';
        let isEditing = false;
        let currentView = 'day'; // 'day', 'week', 'month'
        
        // åˆå§‹åŒ–æ—¥æœŸèŒƒå›´ï¼š2026å¹´2æœˆ7æ—¥è‡³6æœˆ30æ—¥
        const startDate = new Date('2026-02-07');
        const endDate = new Date('2026-06-30');
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        window.onload = function() {
            console.log('é¡µé¢å¼€å§‹åŠ è½½...');
            initApp();
        };
        
        // åˆå§‹åŒ–åº”ç”¨
        function initApp() {
            // è®¾ç½®å½“å‰æ—¥æœŸ
            currentDate = new Date();
            currentDateStr = formatDate(currentDate);
            
            console.log('å½“å‰æ—¥æœŸ:', currentDate);
            console.log('æ ¼å¼åŒ–æ—¥æœŸ:', currentDateStr);
            
            // æ›´æ–°æ—¥æœŸæ˜¾ç¤º
            updateDateDisplay();
            
            // è¿æ¥ Supabase
            connectToSupabase();
            
            // åŠ è½½æ•°æ®
            setTimeout(() => {
                loadData();
            }, 200);
        }
        
        // è¿æ¥ Supabase
        function connectToSupabase() {
            try {
                const { createClient } = window.supabase;
                supabaseClient = createClient(DEFAULT_SUPABASE_URL, DEFAULT_SUPABASE_KEY);
                useSupabase = true;
                
                document.getElementById('storageMode').textContent = 'Supabase äº‘ç«¯';
                document.getElementById('storageMode').className = 'text-blue-600 font-medium';
                
                console.log('Supabase è¿æ¥æˆåŠŸ');
            } catch (error) {
                console.error('Supabase è¿æ¥å¤±è´¥:', error);
                useSupabase = false;
                document.getElementById('storageMode').textContent = 'è¿æ¥å¤±è´¥';
                document.getElementById('storageMode').className = 'text-red-500';
            }
        }
        
        // æ›´æ–°æ—¥æœŸæ˜¾ç¤º
        function updateDateDisplay() {
            currentDateStr = formatDate(currentDate);
            
            const dateTextEl = document.getElementById('currentDateText');
            const weekdayEl = document.getElementById('currentWeekday');
            
            if (dateTextEl) {
                if (currentView === 'day') {
                    dateTextEl.textContent = formatDateCN(currentDate);
                } else if (currentView === 'week') {
                    const weekStart = getWeekStart(currentDate);
                    const weekEnd = getWeekEnd(currentDate);
                    dateTextEl.textContent = `${formatDateCN(weekStart)} - ${formatDateCN(weekEnd)}`;
                } else if (currentView === 'month') {
                    const year = currentDate.getFullYear();
                    const month = currentDate.getMonth() + 1;
                    dateTextEl.textContent = `${year}å¹´${month}æœˆ`;
                }
            }
            
            if (weekdayEl) {
                if (currentView === 'day') {
                    weekdayEl.textContent = getWeekday(currentDate);
                } else {
                    weekdayEl.textContent = currentView === 'week' ? 'æœ¬å‘¨æ•°æ®' : 'æœ¬æœˆæ•°æ®';
                }
            }
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            
            if (prevBtn && nextBtn) {
                if (currentView === 'day') {
                    prevBtn.disabled = currentDate <= startDate;
                    nextBtn.disabled = currentDate >= endDate;
                } else if (currentView === 'week') {
                    const weekStart = getWeekStart(currentDate);
                    prevBtn.disabled = weekStart <= startDate;
                    const weekEnd = getWeekEnd(currentDate);
                    nextBtn.disabled = weekEnd >= endDate;
                } else if (currentView === 'month') {
                    const monthStart = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
                    const monthEnd = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0);
                    prevBtn.disabled = monthStart <= startDate;
                    nextBtn.disabled = monthEnd >= endDate;
                }
                
                prevBtn.style.opacity = prevBtn.disabled ? '0.5' : '1';
                nextBtn.style.opacity = nextBtn.disabled ? '0.5' : '1';
            }
            
            console.log('æ—¥æœŸæ˜¾ç¤ºå·²æ›´æ–°:', currentDateStr, 'è§†å›¾:', currentView);
        }
        
        // æ—¥æœŸå¯¼èˆª
        function previousDay() {
            if (currentDate > startDate) {
                currentDate.setDate(currentDate.getDate() - 1);
                updateDateDisplay();
                loadData();
            }
        }
        
        function nextDay() {
            if (currentDate < endDate) {
                currentDate.setDate(currentDate.getDate() + 1);
                updateDateDisplay();
                loadData();
            }
        }
        
        // è§†å›¾åˆ‡æ¢
        function switchView(view) {
            currentView = view;
            
            // æ›´æ–°æŒ‰é’®æ ·å¼
            const dayBtn = document.getElementById('dayViewBtn');
            const weekBtn = document.getElementById('weekViewBtn');
            const monthBtn = document.getElementById('monthViewBtn');
            
            const activeClass = ['bg-white', 'text-gray-800', 'shadow'];
            const inactiveClass = ['text-gray-600', 'hover:text-gray-800'];
            
            [dayBtn, weekBtn, monthBtn].forEach(btn => {
                btn.classList.remove(...activeClass);
                btn.classList.add(...inactiveClass);
            });
            
            const activeBtn = view === 'day' ? dayBtn : (view === 'week' ? weekBtn : monthBtn);
            activeBtn.classList.remove(...inactiveClass);
            activeBtn.classList.add(...activeClass);
            
            // æ›´æ–°æ—¥æœŸæ˜¾ç¤º
            updateDateDisplay();
            
            // åŠ è½½å¯¹åº”æ•°æ®
            if (view === 'day') {
                loadData();
            } else if (view === 'week') {
                loadWeekDashboard();
            } else if (view === 'month') {
                loadMonthDashboard();
            }
        }
        
        // å‘¨æœŸå¯¼èˆª
        function previousPeriod() {
            if (currentView === 'day') {
                previousDay();
            } else if (currentView === 'week') {
                currentDate.setDate(currentDate.getDate() - 7);
                updateDateDisplay();
                loadWeekDashboard();
            } else if (currentView === 'month') {
                currentDate.setMonth(currentDate.getMonth() - 1);
                updateDateDisplay();
                loadMonthDashboard();
            }
        }
        
        function nextPeriod() {
            if (currentView === 'day') {
                nextDay();
            } else if (currentView === 'week') {
                currentDate.setDate(currentDate.getDate() + 7);
                updateDateDisplay();
                loadWeekDashboard();
            } else if (currentView === 'month') {
                currentDate.setMonth(currentDate.getMonth() + 1);
                updateDateDisplay();
                loadMonthDashboard();
            }
        }
        
        // æ ¼å¼åŒ–æ—¥æœŸ
        function formatDate(date) {
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}-${month}-${day}`;
        }
        
        function formatDateCN(date) {
            const year = date.getFullYear();
            const month = date.getMonth() + 1;
            const day = date.getDate();
            return `${year}å¹´${month}æœˆ${day}æ—¥`;
        }
        
        function getWeekday(date) {
            const weekdays = ['æ˜ŸæœŸæ—¥', 'æ˜ŸæœŸä¸€', 'æ˜ŸæœŸäºŒ', 'æ˜ŸæœŸä¸‰', 'æ˜ŸæœŸå››', 'æ˜ŸæœŸäº”', 'æ˜ŸæœŸå…­'];
            return weekdays[date.getDay()];
        }
        
        // è·å–å‘¨çš„å¼€å§‹æ—¥æœŸï¼ˆå‘¨ä¸€ï¼‰
        function getWeekStart(date) {
            const d = new Date(date);
            const day = d.getDay();
            const diff = d.getDate() - day + (day === 0 ? -6 : 1);
            return new Date(d.setDate(diff));
        }
        
        // è·å–å‘¨çš„ç»“æŸæ—¥æœŸï¼ˆå‘¨æ—¥ï¼‰
        function getWeekEnd(date) {
            const start = getWeekStart(date);
            const end = new Date(start);
            end.setDate(end.getDate() + 6);
            return end;
        }
        
        // å‹åŠ›å€¼æ›´æ–°
        function updateStressValue(value) {
            const stressValueEl = document.getElementById('stressValue');
            if (stressValueEl) {
                stressValueEl.textContent = value;
                const colors = ['#10B981', '#34D399', '#6EE7B7', '#FBBF24', '#F59E0B', '#F97316', '#EF4444', '#DC2626', '#B91C1C', '#991B1B'];
                stressValueEl.style.color = colors[value - 1];
            }
        }
        
        // æœ‰æ°§è¿åŠ¨é€‰æ‹©
        function selectAerobic(value) {
            const yesBtn = document.getElementById('aerobicYes');
            const noBtn = document.getElementById('aerobicNo');
            const yesText = document.getElementById('aerobicYesText');
            const noText = document.getElementById('aerobicNoText');
            
            if (value) {
                yesBtn.classList.add('border-teal-500', 'bg-teal-50');
                yesBtn.classList.remove('border-gray-200');
                yesText.classList.add('text-teal-600', 'font-semibold');
                
                noBtn.classList.remove('border-teal-500', 'bg-teal-50');
                noBtn.classList.add('border-gray-200');
                noText.classList.remove('text-teal-600', 'font-semibold');
            } else {
                noBtn.classList.add('border-teal-500', 'bg-teal-50');
                noBtn.classList.remove('border-gray-200');
                noText.classList.add('text-teal-600', 'font-semibold');
                
                yesBtn.classList.remove('border-teal-500', 'bg-teal-50');
                yesBtn.classList.add('border-gray-200');
                yesText.classList.remove('text-teal-600', 'font-semibold');
            }
        }
        
        // è¡¨å•æäº¤
        document.getElementById('healthForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const data = {
                date: currentDateStr,
                sleep_hours: parseFloat(document.getElementById('sleepHours').value) || null,
                coffee_cups: parseInt(document.getElementById('coffeeCups').value) || null,
                stress_level: parseInt(document.getElementById('stressLevel').value) || null,
                work_hours: parseFloat(document.getElementById('workHours').value) || null,
                pushups: parseInt(document.getElementById('pushups').value) || null,
                exercise_minutes: parseInt(document.getElementById('exerciseMinutes').value) || null,
                aerobic: document.querySelector('input[name="aerobic"]:checked')?.value === 'true'
            };
            
            try {
                if (useSupabase) {
                    await saveToSupabase(data);
                } else {
                    saveToLocal(data);
                }
                
                resetForm();
                loadData();
                
                alert('ä¿å­˜æˆåŠŸï¼');
            } catch (error) {
                console.error('ä¿å­˜å¤±è´¥:', error);
                alert('ä¿å­˜å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
            }
        });
        
        // ä¿å­˜åˆ° Supabase
        async function saveToSupabase(data) {
            // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨è®°å½•
            const { data: existing, error: checkError } = await supabaseClient
                .from('daily_records')
                .select('id')
                .eq('date', data.date)
                .single();
            
            if (existing) {
                // æ›´æ–°ç°æœ‰è®°å½•
                const { error } = await supabaseClient
                    .from('daily_records')
                    .update({
                        sleep_hours: data.sleep_hours,
                        coffee_cups: data.coffee_cups,
                        stress_level: data.stress_level,
                        work_hours: data.work_hours,
                        pushups: data.pushups,
                        exercise_minutes: data.exercise_minutes,
                        aerobic: data.aerobic,
                        updated_at: new Date().toISOString()
                    })
                    .eq('date', data.date);
                
                if (error) throw error;
            } else {
                // æ’å…¥æ–°è®°å½•
                const { error } = await supabaseClient
                    .from('daily_records')
                    .insert([data]);
                
                if (error) throw error;
            }
        }
        
        // ä¿å­˜åˆ°æœ¬åœ°
        function saveToLocal(data) {
            let records = JSON.parse(localStorage.getItem('dailyHealth2026_records') || '{}');
            records[data.date] = {
                ...data,
                created_at: new Date().toISOString(),
                updated_at: new Date().toISOString()
            };
            localStorage.setItem('dailyHealth2026_records', JSON.stringify(records));
        }
        
        // åŠ è½½æ•°æ®
        async function loadData() {
            let data = null;
            
            if (useSupabase) {
                data = await loadFromSupabase();
            } else {
                data = loadFromLocal();
            }
            
            console.log('åŠ è½½åˆ°çš„æ•°æ®:', data);
            
            if (data) {
                displayData(data);
            } else {
                showForm();
            }
        }
        
        // åŠ è½½å‘¨ä»ªè¡¨æ¿æ•°æ®
        async function loadWeekDashboard() {
            const weekStart = getWeekStart(currentDate);
            const weekEnd = getWeekEnd(currentDate);
            
            let allData = [];
            
            if (useSupabase) {
                const startDateStr = formatDate(weekStart);
                const endDateStr = formatDate(weekEnd);
                
                const { data, error } = await supabaseClient
                    .from('daily_records')
                    .select('*')
                    .gte('date', startDateStr)
                    .lte('date', endDateStr);
                
                if (error) {
                    console.error('ä» Supabase åŠ è½½å‘¨æ•°æ®å¤±è´¥:', error);
                } else {
                    allData = data || [];
                }
            } else {
                const records = JSON.parse(localStorage.getItem('dailyHealth2026_records') || '{}');
                for (let date in records) {
                    const recordDate = new Date(date);
                    if (recordDate >= weekStart && recordDate <= weekEnd) {
                        allData.push(records[date]);
                    }
                }
            }
            
            displayDashboard('week', allData, formatDateCN(weekStart) + ' - ' + formatDateCN(weekEnd));
        }
        
        // åŠ è½½æœˆä»ªè¡¨æ¿æ•°æ®
        async function loadMonthDashboard() {
            const monthStart = new Date(currentDate.getFullYear(), currentDate.getMonth(), 1);
            const monthEnd = new Date(currentDate.getFullYear(), currentDate.getMonth() + 1, 0);
            
            let allData = [];
            
            if (useSupabase) {
                const startDateStr = formatDate(monthStart);
                const endDateStr = formatDate(monthEnd);
                
                const { data, error } = await supabaseClient
                    .from('daily_records')
                    .select('*')
                    .gte('date', startDateStr)
                    .lte('date', endDateStr);
                
                if (error) {
                    console.error('ä» Supabase åŠ è½½æœˆæ•°æ®å¤±è´¥:', error);
                } else {
                    allData = data || [];
                }
            } else {
                const records = JSON.parse(localStorage.getItem('dailyHealth2026_records') || '{}');
                for (let date in records) {
                    const recordDate = new Date(date);
                    if (recordDate >= monthStart && recordDate <= monthEnd) {
                        allData.push(records[date]);
                    }
                }
            }
            
            const year = currentDate.getFullYear();
            const month = currentDate.getMonth() + 1;
            displayDashboard('month', allData, `${year}å¹´${month}æœˆ`);
        }
        
        // æ˜¾ç¤ºä»ªè¡¨æ¿
        function displayDashboard(type, data, periodText) {
            const formSection = document.getElementById('formSection');
            const displaySection = document.getElementById('displaySection');
            const dashboardSection = document.getElementById('dashboardSection');
            const dashboardTitle = document.getElementById('dashboardTitle');
            
            if (formSection) formSection.classList.add('hidden');
            if (displaySection) displaySection.classList.add('hidden');
            if (dashboardSection) {
                dashboardSection.classList.remove('hidden');
                dashboardSection.classList.add('fade-in');
            }
            
            if (dashboardTitle) {
                dashboardTitle.textContent = `${type === 'week' ? 'å‘¨' : 'æœˆ'}ç»Ÿè®¡ (${periodText})`;
            }
            
            // è®¡ç®—ç»Ÿè®¡æ•°æ®
            let totalSleepHours = 0;
            let totalWorkHours = 0;
            let totalExerciseHours = 0;
            let totalPushups = 0;
            let stressSum = 0;
            let stressCount = 0;
            
            data.forEach(record => {
                if (record.sleep_hours) totalSleepHours += record.sleep_hours;
                if (record.work_hours) totalWorkHours += record.work_hours;
                if (record.exercise_minutes) totalExerciseHours += record.exercise_minutes / 60; // è½¬æ¢ä¸ºå°æ—¶
                if (record.pushups) totalPushups += record.pushups;
                if (record.stress_level) {
                    stressSum += record.stress_level;
                    stressCount++;
                }
            });
            
            const avgStress = stressCount > 0 ? (stressSum / stressCount).toFixed(1) : 0;
            
            // æ˜¾ç¤ºç»Ÿè®¡æŒ‡æ ‡
            const metrics = [
                { label: 'ç¡çœ æ€»æ—¶é•¿', value: totalSleepHours.toFixed(1), unit: 'å°æ—¶', icon: 'ğŸŒ™', color: 'indigo' },
                { label: 'å·¥ä½œæ€»æ—¶é•¿', value: totalWorkHours.toFixed(1), unit: 'å°æ—¶', icon: 'ğŸ’¼', color: 'blue' },
                { label: 'è¿åŠ¨æ€»æ—¶é•¿', value: totalExerciseHours.toFixed(1), unit: 'å°æ—¶', icon: 'ğŸƒ', color: 'purple' },
                { label: 'ä¿¯å§æ’‘æ€»æ•°', value: totalPushups, unit: 'ä¸ª', icon: 'ğŸ’ª', color: 'green' },
                { label: 'å¹³å‡å‹åŠ›å€¼', value: avgStress, unit: 'åˆ†', icon: 'ğŸ˜°', color: 'red' }
            ];
            
            const dashboardContainer = document.getElementById('dashboardMetrics');
            if (dashboardContainer) {
                dashboardContainer.innerHTML = '';
                
                metrics.forEach(metric => {
                    const card = document.createElement('div');
                    card.className = `metric-card bg-${metric.color}-50 rounded-xl p-4`;
                    card.innerHTML = `
                        <div class="flex items-center mb-2">
                            <span class="text-2xl mr-2">${metric.icon}</span>
                            <span class="text-sm text-gray-600">${metric.label}</span>
                        </div>
                        <div class="text-2xl font-bold text-${metric.color}-600">${metric.value} ${metric.unit}</div>
                    `;
                    dashboardContainer.appendChild(card);
                });
                
                if (data.length === 0) {
                    dashboardContainer.innerHTML = '<p class="col-span-2 text-center text-gray-400 py-8">è¯¥æ—¶æ®µæš‚æ— è®°å½•æ•°æ®</p>';
                }
            }
        }
        
        // ä» Supabase åŠ è½½
        async function loadFromSupabase() {
            try {
                const { data, error } = await supabaseClient
                    .from('daily_records')
                    .select('*')
                    .eq('date', currentDateStr)
                    .single();
                
                if (error && error.code !== 'PGRST116') {
                    console.error('ä» Supabase åŠ è½½å¤±è´¥:', error);
                    return null;
                }
                
                return data;
            } catch (error) {
                console.error('ä» Supabase åŠ è½½å¼‚å¸¸:', error);
                return null;
            }
        }
        
        // ä»æœ¬åœ°åŠ è½½
        function loadFromLocal() {
            const records = JSON.parse(localStorage.getItem('dailyHealth2026_records') || '{}');
            return records[currentDateStr] || null;
        }
        
        // æ˜¾ç¤ºæ•°æ®
        function displayData(data) {
            const formSection = document.getElementById('formSection');
            const displaySection = document.getElementById('displaySection');
            
            if (formSection) formSection.classList.add('hidden');
            if (displaySection) {
                displaySection.classList.remove('hidden');
                displaySection.classList.add('fade-in');
            }
            
            const metrics = [
                { key: 'sleep_hours', label: 'ç¡çœ æ—¶é•¿', unit: 'å°æ—¶', icon: 'ğŸŒ™', color: 'indigo' },
                { key: 'coffee_cups', label: 'å’–å•¡æ¯æ•°', unit: 'æ¯', icon: 'â˜•', color: 'amber' },
                { key: 'stress_level', label: 'å‹åŠ›å€¼', unit: 'åˆ†', icon: 'ğŸ˜°', color: 'red' },
                { key: 'work_hours', label: 'å·¥ä½œæ—¶é•¿', unit: 'å°æ—¶', icon: 'ğŸ’¼', color: 'blue' },
                { key: 'pushups', label: 'ä¿¯å§æ’‘', unit: 'ä¸ª', icon: 'ğŸ’ª', color: 'green' },
                { key: 'exercise_minutes', label: 'é”»ç‚¼æ—¶é•¿', unit: 'åˆ†é’Ÿ', icon: 'ğŸƒ', color: 'purple' },
                { key: 'aerobic', label: 'æœ‰æ°§è¿åŠ¨', unit: '', icon: 'âœ¨', color: 'teal', isBoolean: true }
            ];
            
            const displayContainer = document.getElementById('metricsDisplay');
            if (displayContainer) {
                displayContainer.innerHTML = '';
                
                metrics.forEach(metric => {
                    const value = data[metric.key];
                    if (value !== null && value !== undefined && value !== '') {
                        const displayValue = metric.isBoolean ? (value ? 'æ˜¯' : 'å¦') : value;
                        const card = document.createElement('div');
                        card.className = `metric-card bg-${metric.color}-50 rounded-xl p-4`;
                        card.innerHTML = `
                            <div class="flex items-center mb-2">
                                <span class="text-2xl mr-2">${metric.icon}</span>
                                <span class="text-sm text-gray-600">${metric.label}</span>
                            </div>
                            <div class="text-2xl font-bold text-${metric.color}-600">${displayValue}${metric.unit ? ' ' + metric.unit : ''}</div>
                        `;
                        displayContainer.appendChild(card);
                    }
                });
                
                if (displayContainer.children.length === 0) {
                    displayContainer.innerHTML = '<p class="col-span-2 text-center text-gray-400 py-8">æš‚æ— è®°å½•æ•°æ®</p>';
                }
            }
        }
        
        // æ˜¾ç¤ºè¡¨å•
        function showForm() {
            const formSection = document.getElementById('formSection');
            const displaySection = document.getElementById('displaySection');
            const formTitle = document.getElementById('formTitle');
            const cancelBtn = document.getElementById('cancelBtn');
            
            if (displaySection) displaySection.classList.add('hidden');
            if (formSection) {
                formSection.classList.remove('hidden');
                formSection.classList.add('fade-in');
            }
            if (formTitle) formTitle.textContent = `è®°å½• ${formatDateCN(currentDate)} æ•°æ®`;
            isEditing = false;
            if (cancelBtn) cancelBtn.classList.add('hidden');
        }
        
        // ç¼–è¾‘è®°å½•
        async function editRecord() {
            let data = null;
            if (useSupabase) {
                data = await loadFromSupabase();
            } else {
                data = loadFromLocal();
            }
            
            if (!data) return;
            
            // å¡«å……è¡¨å•
            document.getElementById('sleepHours').value = data.sleep_hours || '';
            document.getElementById('coffeeCups').value = data.coffee_cups || '';
            document.getElementById('stressLevel').value = data.stress_level || 5;
            updateStressValue(data.stress_level || 5);
            document.getElementById('workHours').value = data.work_hours || '';
            document.getElementById('pushups').value = data.pushups || '';
            document.getElementById('exerciseMinutes').value = data.exercise_minutes || '';
            
            if (data.aerobic !== null && data.aerobic !== undefined) {
                selectAerobic(data.aerobic);
                const yesRadio = document.querySelector('input[name="aerobic"][value="true"]');
                const noRadio = document.querySelector('input[name="aerobic"][value="false"]');
                if (data.aerobic) {
                    yesRadio.checked = true;
                } else {
                    noRadio.checked = true;
                }
            }
            
            // æ˜¾ç¤ºè¡¨å•
            const formSection = document.getElementById('formSection');
            const displaySection = document.getElementById('displaySection');
            const formTitle = document.getElementById('formTitle');
            const cancelBtn = document.getElementById('cancelBtn');
            
            if (displaySection) displaySection.classList.add('hidden');
            if (formSection) {
                formSection.classList.remove('hidden');
                formSection.classList.add('fade-in');
            }
            if (formTitle) formTitle.textContent = `ç¼–è¾‘ ${formatDateCN(currentDate)} æ•°æ®`;
            isEditing = true;
            if (cancelBtn) cancelBtn.classList.remove('hidden');
        }
        
        // å–æ¶ˆç¼–è¾‘
        function cancelEdit() {
            resetForm();
            loadData();
        }
        
        // åˆ é™¤è®°å½•
        async function deleteRecord() {
            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡è®°å½•å—ï¼Ÿ')) return;
            
            try {
                if (useSupabase) {
                    const { error } = await supabaseClient
                        .from('daily_records')
                        .delete()
                        .eq('date', currentDateStr);
                    
                    if (error) throw error;
                } else {
                    let records = JSON.parse(localStorage.getItem('dailyHealth2026_records') || '{}');
                    delete records[currentDateStr];
                    localStorage.setItem('dailyHealth2026_records', JSON.stringify(records));
                }
                
                loadData();
                alert('åˆ é™¤æˆåŠŸï¼');
            } catch (error) {
                console.error('åˆ é™¤å¤±è´¥:', error);
                alert('åˆ é™¤å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•');
            }
        }
        
        // é‡ç½®è¡¨å•
        function resetForm() {
            document.getElementById('healthForm').reset();
            document.getElementById('stressLevel').value = 5;
            updateStressValue(5);
            
            // é‡ç½®æœ‰æ°§è¿åŠ¨é€‰æ‹©
            const yesBtn = document.getElementById('aerobicYes');
            const noBtn = document.getElementById('aerobicNo');
            const yesText = document.getElementById('aerobicYesText');
            const noText = document.getElementById('aerobicNoText');
            
            yesBtn.classList.remove('border-teal-500', 'bg-teal-50');
            noBtn.classList.remove('border-teal-500', 'bg-teal-50');
            yesText.classList.remove('text-teal-600', 'font-semibold');
            noText.classList.remove('text-teal-600', 'font-semibold');
            
            const radios = document.querySelectorAll('input[name="aerobic"]');
            radios.forEach(radio => radio.checked = false);
        }
        
        // é‡ç½®é…ç½®
        function resetConfig() {
            if (confirm('ç¡®å®šè¦é‡æ–°é…ç½®æ•°æ®åº“å—ï¼Ÿ')) {
                localStorage.removeItem('dailyHealth2026_url');
                localStorage.removeItem('dailyHealth2026_key');
                localStorage.removeItem('dailyHealth2026_storage');
                location.reload();
            }
        }
    </script>
</body>
</html>
